(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"/on3":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return W}));var i=n("n2fA"),o=n("FQBZ"),s=n("dT8p"),a=n("2Vo4"),c=n("0EQZ"),r=n("FvrZ"),l=n("8yBR"),d=n("STbY"),h=n("fXoL"),g=n("tyNb"),u=n("Witw"),p=n("aceb"),b=n("gvxT"),f=n("kmnG"),m=n("qFsG"),v=n("ofXK"),C=n("d3UM"),F=n("3Pt+"),x=n("bTqV"),y=n("FKr1"),S=n("IyRd"),w=n("znSr"),I=n("NFeN");const k=["emptyItem"],O=["qrPop"],N=["createPop"],P=["newFavoriteFolder"];function M(e,t){if(1&e&&(h.Yb(0,"mat-option",24),h.Ic(1),h.Xb()),2&e){const e=t.$implicit;h.pc("value",e.id),h.Fb(1),h.Kc(" ",e.data.name," ")}}function X(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"Create Channel"),h.Xb(),h.Yb(3,"nb-card-body",16),h.Yb(4,"div",17),h.Ic(5," Folder: "),h.Yb(6,"mat-select",18),h.fc("valueChange",(function(t){return h.xc(e),h.jc().newChannelFolder=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newChannelFolderChanged(t.value)})),h.Gc(7,M,2,2,"mat-option",19),h.Xb(),h.Xb(),h.Yb(8,"div",20),h.Yb(9,"input",21),h.fc("ngModelChange",(function(t){return h.xc(e),h.jc().newChannelName=t})),h.Xb(),h.Xb(),h.Xb(),h.Yb(10,"nb-card-footer"),h.Yb(11,"button",22),h.fc("click",(function(){h.xc(e);const t=h.jc();return t.createNewChannel(t.newChannelName)})),h.Ic(12,"Create"),h.Xb(),h.Yb(13,"button",23),h.fc("click",(function(){return h.xc(e),h.jc().closePopup()})),h.Ic(14,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(6),h.pc("value",e.newChannelFolder),h.Fb(1),h.pc("ngForOf",e.channelFolderListArray),h.Fb(2),h.pc("ngModel",e.newChannelName)}}function Y(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"Scan QR"),h.Xb(),h.Yb(3,"nb-card-body",16),h.Yb(4,"div",25),h.Yb(5,"zxing-scanner",26),h.fc("deviceChange",(function(t){return h.xc(e),h.jc().currentDevice=t}))("scanSuccess",(function(t){return h.xc(e),h.jc().qrSuccessHandler(t)}))("permissionResponse",(function(t){return h.xc(e),h.jc().onHasPermission(t)}))("camerasFound",(function(t){return h.xc(e),h.jc().onCamerasFound(t)}))("torchCompatible",(function(t){return h.xc(e),h.jc().onTorchCompatible(t)})),h.Xb(),h.Xb(),h.Xb(),h.Yb(6,"nb-card-footer"),h.Yb(7,"button",23),h.fc("click",(function(){return h.xc(e),h.jc().closeQR()})),h.Ic(8,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(5),h.pc("torch",e.torchEnabled)("device",e.currentDevice)("formats",e.formatsEnabled)("tryHarder",e.tryHarder)}}function j(e,t){if(1&e&&(h.Yb(0,"mat-option",24),h.Ic(1),h.Xb()),2&e){const e=t.$implicit;h.pc("value",e.id),h.Fb(1),h.Kc(" ",e.data.name," ")}}function q(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"Join Channel"),h.Xb(),h.Yb(3,"nb-card-body",16),h.Yb(4,"div",17),h.Ic(5," Import Folder Structure: "),h.Yb(6,"mat-form-field",27),h.Yb(7,"mat-select",28),h.fc("valueChange",(function(t){return h.xc(e),h.jc().importFolderStructure=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newInviteImportFoldersChanged(t.value)})),h.Yb(8,"mat-option",24),h.Ic(9," On "),h.Xb(),h.Yb(10,"mat-option",24),h.Ic(11," Off "),h.Xb(),h.Xb(),h.Xb(),h.Xb(),h.Yb(12,"div",17),h.Ic(13," Place Into Folder: "),h.Yb(14,"mat-select",18),h.fc("valueChange",(function(t){return h.xc(e),h.jc().newChannelFolder=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newChannelFolderChanged(t.value)})),h.Gc(15,j,2,2,"mat-option",19),h.Xb(),h.Xb(),h.Yb(16,"div",20),h.Yb(17,"input",29),h.fc("ngModelChange",(function(t){return h.xc(e),h.jc().inviteCodeHex=t})),h.Xb(),h.Yb(18,"nb-icon",30),h.fc("click",(function(){return h.xc(e),h.jc().scanQR()})),h.Xb(),h.Xb(),h.Xb(),h.Yb(19,"nb-card-footer"),h.Yb(20,"button",22),h.fc("click",(function(){h.xc(e);const t=h.jc();return t.importNewChannel(t.inviteCode)})),h.Ic(21,"Join"),h.Xb(),h.Yb(22,"button",23),h.fc("click",(function(){return h.xc(e),h.jc().closePopup()})),h.Ic(23,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(7),h.pc("value",e.importFolderStructure),h.Fb(1),h.pc("value",1),h.Fb(2),h.pc("value",0),h.Fb(4),h.pc("value",e.newChannelFolder),h.Fb(1),h.pc("ngForOf",e.channelFolderListArray),h.Fb(2),h.pc("ngModel",e.inviteCodeHex)}}function T(e,t){if(1&e&&(h.Yb(0,"mat-option",24),h.Ic(1),h.Xb()),2&e){const e=t.$implicit;h.pc("value",e.id),h.Fb(1),h.Kc(" ",e.data.name," ")}}function E(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"New Favorite Folder"),h.Xb(),h.Yb(3,"nb-card-body",16),h.Yb(4,"div",17),h.Ic(5," Folder: "),h.Yb(6,"mat-select",18),h.fc("valueChange",(function(t){return h.xc(e),h.jc().newFavoriteFolderId=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newFavoriteFolderChanged(t.value)})),h.Gc(7,T,2,2,"mat-option",19),h.Xb(),h.Xb(),h.Yb(8,"div",20),h.Yb(9,"input",31),h.fc("ngModelChange",(function(t){return h.xc(e),h.jc().newFavoriteFolderName=t})),h.Xb(),h.Xb(),h.Xb(),h.Yb(10,"nb-card-footer"),h.Yb(11,"button",22),h.fc("click",(function(){h.xc(e);const t=h.jc();return t.createNewFavoriteFolder(t.newFavoriteFolderName)})),h.Ic(12,"Create"),h.Xb(),h.Yb(13,"button",23),h.fc("click",(function(){return h.xc(e),h.jc().closePopup()})),h.Ic(14,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(6),h.pc("value",e.newFavoriteFolderId),h.Fb(1),h.pc("ngForOf",e.favoriteFolderListArray),h.Fb(2),h.pc("ngModel",e.newFavoriteFolderName)}}function B(e,t){if(1&e){const e=h.Zb();h.Yb(0,"div",36),h.fc("click",(function(){h.xc(e);const t=h.jc().$implicit;return h.jc().goToProfile(t.pubKey)})),h.Ic(1),h.Xb()}if(2&e){const e=h.jc().$implicit,t=h.jc();h.Fb(1),h.Kc(" ",t.getAliasFromDirectChannel(e.channel),"")}}function D(e,t){if(1&e){const e=h.Zb();h.Yb(0,"div",36),h.fc("click",(function(){h.xc(e);const t=h.jc().$implicit;return h.jc().goToProfile(t.pubKey)})),h.Ic(1," Unknown"),h.Xb()}}function L(e,t){if(1&e){const e=h.Zb();h.Yb(0,"div",32),h.Gc(1,B,2,1,"div",33),h.Gc(2,D,2,0,"div",33),h.Yb(3,"nb-icon",34),h.fc("click",(function(){h.xc(e);const n=t.$implicit;return h.jc().rejectRequest(n.pubKey)})),h.Xb(),h.Yb(4,"nb-icon",35),h.fc("click",(function(){h.xc(e);const n=t.$implicit;return h.jc().importNewChannel(n.invite)})),h.Xb(),h.Xb()}if(2&e){const e=t.$implicit,n=h.jc();h.Fb(1),h.pc("ngIf",n.getAliasFromDirectChannel(e.channel).indexOf("qprivatedch")<0),h.Fb(1),h.pc("ngIf",n.getAliasFromDirectChannel(e.channel).indexOf("qprivatedch")>-1)}}const _=function(e){return{"drag-start":e}};function R(e,t){if(1&e){const e=h.Zb();h.Yb(0,"div"),h.Tb(1,"nb-icon",39),h.Yb(2,"span",40),h.fc("dragstart",(function(t){h.xc(e);const n=h.jc().$implicit;return h.jc().handleDragStart(t,n)})),h.Yb(3,"span",41),h.Ic(4),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc().$implicit,t=h.jc();h.Ib("treeNodeContainerSingle ",e.item,""),h.Kb("active-channel",t.selectedChannel===e.item),h.Fb(3),h.pc("ngClass",h.sc(7,_,t.dragNode===e)),h.Fb(1),h.Kc(" ",t.getAliasFromDirectChannel2(e.item)," ")}}function A(e,t){if(1&e){const e=h.Zb();h.Yb(0,"div"),h.Tb(1,"nb-icon",42),h.Yb(2,"span",40),h.fc("dragstart",(function(t){h.xc(e);const n=h.jc().$implicit;return h.jc().handleDragStart(t,n)})),h.Yb(3,"span",43),h.Ic(4," Unknown "),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc().$implicit,t=h.jc();h.Ib("treeNodeContainerSingle ",e.item,""),h.Kb("active-channel",t.selectedChannel===e.item),h.Fb(3),h.pc("ngClass",h.sc(6,_,t.dragNode===e))}}function K(e,t){if(1&e){const e=h.Zb();h.Yb(0,"mat-tree-node",37),h.fc("dragover",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragOver(n,i)}))("dragend",(function(t){return h.xc(e),h.jc().handleDragEnd(t)}))("drop",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDrop(n,i)}))("click",(function(){h.xc(e);const n=t.$implicit;return h.jc().selectChannel(n.item)})),h.Gc(1,R,5,9,"div",38),h.Gc(2,A,5,8,"div",38),h.Xb()}if(2&e){const e=t.$implicit,n=h.jc();h.pc("ngClass",n.getStyle(e)),h.Fb(1),h.pc("ngIf",n.getAliasFromDirectChannel2(e.item).indexOf("qprivatedch")<0),h.Fb(1),h.pc("ngIf",n.getAliasFromDirectChannel2(e.item).indexOf("qprivatedch")>-1)}}function G(e,t){if(1&e){const e=h.Zb();h.Yb(0,"mat-tree-node",44),h.fc("dragover",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragOver(n,i)}))("dragend",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragEnd(n,i)}))("drop",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDrop(n,i)})),h.Yb(1,"div",45),h.fc("contextmenu",(function(n){h.xc(e);const i=t.$implicit;return h.jc().onContextMenu(n,i.item)})),h.Yb(2,"button",46),h.Yb(3,"mat-icon",47),h.Ic(4),h.Xb(),h.Xb(),h.Tb(5,"nb-icon",48),h.Yb(6,"span",40),h.fc("dragstart",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragStart(n,i)})),h.Yb(7,"span",49),h.Ic(8),h.Xb(),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=t.$implicit,n=h.jc();h.pc("ngClass",n.getStyle(e)),h.Fb(2),h.Gb("aria-label","toggle "+e.item),h.Fb(2),h.Kc(" ",n.treeControl.isExpanded(e)?"expand_more":"chevron_right"," "),h.Fb(3),h.pc("ngClass",h.sc(5,_,n.dragNode===e)),h.Fb(1),h.Kc(" ",n.getFavoriteFolderNameFromId(e.item)," ")}}function z(e,t){if(1&e){const e=h.Zb();h.Yb(0,"button",50),h.fc("click",(function(){h.xc(e);const n=t.item;return h.jc().deleteFolder(n)})),h.Ic(1,"Delete"),h.Xb(),h.Yb(2,"button",50),h.fc("click",(function(){h.xc(e);const n=t.item;return h.jc().onContextMenuAction2(n)})),h.Ic(3,"Rename"),h.Xb(),h.Yb(4,"button",50),h.fc("click",(function(){h.xc(e);const n=t.item;return h.jc().onContextMenuAction2(n)})),h.Ic(5,"New Channel"),h.Xb()}}class H{}class ${}var V={};let Z=(()=>{class e{constructor(){this.dataChange=new a.a([]),this.initialize()}get data(){return this.dataChange.value}initialize(){this.buildFileTree(V,0)}buildFileTree(e,t){return Object.keys(e).reduce((n,i)=>{const o=e[i],s=new H;return s.item=i,null!=o&&("object"==typeof o?s.children=this.buildFileTree(o,t+1):s.item=o),n.concat(s)},[])}insertItem(e,t){e.children||(e.children=[]);const n={item:t};return e.children.push(n),this.dataChange.next(this.data),n}getParentFromNodes(e){for(let t=0;t<this.data.length;++t){const n=this.getParent(this.data[t],e);if(null!=n)return n}return null}getParent(e,t){if(e.children&&e.children.length>0)for(let n=0;n<e.children.length;++n){const i=e.children[n];if(i===t)return e;if(i.children&&i.children.length>0){const e=this.getParent(i,t);if(null!=e)return e}}return null}updateItem(e,t){e.item=t,this.dataChange.next(this.data)}deleteItem(e){this.deleteNode(this.data,e),this.dataChange.next(this.data)}copyPasteItem(e,t){const n=this.insertItem(t,e.item);return e.children&&e.children.forEach(e=>{this.copyPasteItem(e,n)}),n}deleteNode(e,t){const n=e.indexOf(t,0);n>-1?e.splice(n,1):e.forEach(e=>{e.children&&e.children.length>0&&this.deleteNode(e.children,t)})}filter(e){let t;t=e&&e.length>0?{Filter:{emptyFolder:{}},Function:{emptyFolder:{}},Missing:{emptyFolder:{}}}:V;const n=this.buildFileTree(t,0);this.dataChange.next(n)}setQOS(e){this.q=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=h.Ob({token:e,factory:e.\u0275fac}),e})(),W=(()=>{class t{constructor(e,t,n,i,d,h,g,u){this.router=e,this.ngZone=t,this.cd=n,this.database=i,this.ui=d,this.dialog=h,this.nbMenuService=g,this.q=u,this.contextMenuPosition={x:"0px",y:"0px"},this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.newItemName="",this.checklistSelection=new c.c(!0),this.dragNodeExpandOverWaitTimeMs=300,this.getLevel=e=>e.level,this.isExpandable=e=>e.expandable,this.getChildren=e=>e.children,this.hasChild=(e,t)=>t.expandable,this.hasNoContent=(e,t)=>""===t.item,this.transformer=(e,t)=>{const n=this.nestedNodeMap.get(e),i=n&&n.item===e.item?n:new $;return i.item=e.item,i.level=t,i.expandable=e.children&&e.children.length>0,this.flatNodeMap.set(i,e),this.nestedNodeMap.set(e,i),i},this.dragNodeExpandOverAreaReal=0,this.channelNameList=[],this.incomingFavoriteRequestList=[],this.restoreFlag=0,this.sENwriteBlock=0,this.channelIsSelected="active-channel",this.DEVMODE=s.dev,this.customColumn="name",this.items=[{title:"New Favorite Folder"},{title:"Add Favorite"}],this.currentDevice=null,this.formatsEnabled=[o.BarcodeFormat.QR_CODE],this.torchEnabled=!1,this.torchAvailable$=new a.a(!1),this.tryHarder=!1,this.favoriteFolderListArray=[],this.popupRef=[],this.flatChannelNameList={},this.flatChannelNameList2={},this.flatChannelNeeded=[],this.flatChannelNeeded2=[],this.itemClickSub=this.nbMenuService.onItemClick().subscribe(e=>{"New Favorite Folder"==String(e.item.title)&&(this.getFavoriteFolderList(),this.open(this.newFavoriteFolderPop))}),this.database.setQOS(this.q),this.treeFlattener=new l.c(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new r.j(this.getLevel,this.isExpandable),this.dataSource=new l.b(this.treeControl,this.treeFlattener)}onContextMenu(e,t){e.preventDefault(),this.contextMenuPosition.x=e.clientX+"px",this.contextMenuPosition.y=e.clientY-40+"px",this.contextMenu.menuData={item:t},this.contextMenu.openMenu()}onContextMenuAction1(e){}onContextMenuAction2(e){}descendantsAllSelected(e){return this.treeControl.getDescendants(e).every(e=>this.checklistSelection.isSelected(e))}descendantsPartiallySelected(e){return this.treeControl.getDescendants(e).some(e=>this.checklistSelection.isSelected(e))&&!this.descendantsAllSelected(e)}todoItemSelectionToggle(e){this.checklistSelection.toggle(e);const t=this.treeControl.getDescendants(e);this.checklistSelection.isSelected(e)?this.checklistSelection.select(...t):this.checklistSelection.deselect(...t)}saveNode(e,t){const n=this.flatNodeMap.get(e);this.database.updateItem(n,t)}handleDragStart(e,t){this.dragNode=t,this.treeControl.collapse(t)}handleDragOver(e,t){if(e.preventDefault(),-1===t.item.indexOf("-----")){this.dragNodeExpandOverNode&&t===this.dragNodeExpandOverNode?Date.now()-this.dragNodeExpandOverTime>this.dragNodeExpandOverWaitTimeMs&&(this.treeControl.isExpanded(t)||this.treeControl.expand(t)):(this.dragNodeExpandOverNode=t,this.dragNodeExpandOverTime=(new Date).getTime());const n=e.offsetY/e.target.clientHeight;0<=n&&n<=.25?(this.dragNodeExpandOverArea=0,this.dragNodeExpandOverAreaReal=1):1>=n&&n>=.75?(this.dragNodeExpandOverArea=0,this.dragNodeExpandOverAreaReal=-1):(this.dragNodeExpandOverAreaReal=0,this.dragNodeExpandOverArea=0)}}handleDrop(e,t){if(t!==this.dragNode&&t.item.indexOf("-----")<0){let e;1===this.dragNodeExpandOverAreaReal||-1===this.dragNodeExpandOverAreaReal||(e=this.flatNodeMap.get(this.dragNode),this.database.deleteItem(e),e=this.database.copyPasteItem(e,this.flatNodeMap.get(t)),this.saveExpandedNodes(),this.buildFavoriteFolderListFromTreeNodeData())}this.handleDragEnd(e)}handleDragEnd(e){this.dragNode=null,this.dragNodeExpandOverNode=null,this.dragNodeExpandOverTime=0,this.dragNodeExpandOverArea=NaN,e.preventDefault()}getStyle(e){if("emptyFolder"==e.item)return"display-none";if(this.dragNode===e)return"drag-start";if(this.dragNodeExpandOverNode===e)switch(this.dragNodeExpandOverArea){case 1:return"drop-above";case-1:return"drop-below";default:return"drop-center"}}closeQR(){setTimeout(()=>{this.closePopup()},500)}scanQR(){this.open(this.qrPop)}deleteItem(e){this.database.deleteItem(this.flatNodeMap.get(e))}filterChanged(e){this.database.filter(e),e?this.treeControl.expandAll():this.treeControl.collapseAll()}getFavoriteFolderNameFromId(e){return"emptyFolder"==e?e:this.q.os.bee.config.getFavoriteFolderNameFromId(e)}isFolder(e){return!(e.indexOf("-----")>-1)}buildFavoritelFolderListFromTreeNodeData(){console.log("!!!!!"),console.log(this.database.data);let e=this.database.data;e=e.filter(e=>"emptyFolder"!=e.item);let t=[];for(let n=0;n<e.length;n++){console.log(e[n]);let i="dir";e[n].item.indexOf("-----")>-1&&(i="channel"),console.log(i);let o=[];void 0!==e[n].children&&e[n].children.length>0&&(o=this.getFavoriteFolderListTreeChildrenRec(e[n].children)),t.push({id:e[n].item,data:{name:this.q.os.bee.config.getFavoriteFolderNameFromId(e[n].item),kind:i,items:0},children:o})}return this.q.os.bee.config.setFavoriteFolderList(t),!0}ngOnDestroy(){console.log("ChannelList: ngOnDestroy..."),clearInterval(this.updateNamesInterval),this.itemClickSub.unsubscribe(),this.dataChangeSub.unsubscribe(),this.favoriteFolderListSub.unsubscribe(),this.selectedChannelSub.unsubscribe()}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){for(;!this.q.os.isSignedIn();)console.log("ChannelList: Waiting for OS Sign In..."),yield this.ui.delay(1e3);this.updateNamesInterval=setInterval(()=>{this.saveExpandedNodes(),this.loadChannels(this.favoriteFolderList),setTimeout(()=>{this.saveExpandedNodes(),this.loadChannels(this.favoriteFolderList)},2e3)},2e4),this.channelNameList=this.q.os.ocean.dolphin.getChannelNameList(),this.favoriteFolderList=this.q.os.bee.config.getFavoriteFolderList(),this.dataChangeSub=this.database.dataChange.subscribe(e=>{this.dataSource.data=[],this.dataSource.data=e}),this.favoriteFolderListSub=this.q.os.bee.config.favoriteFolderListSub.subscribe(e=>{this.loadChannels(e)}),this.selectedChannelSub=this.q.os.channel.onSelect().subscribe(e=>{this.selectedChannel=e}),this.loadChannels(this.favoriteFolderList),setTimeout(()=>{this.saveExpandedNodes(),this.loadChannels(this.favoriteFolderList)},2e3),this.selectedChannel=this.q.os.channel.getSelected(),this.cd.detectChanges()}))}loadChannels(e){this.incomingFavoriteRequestList=this.q.os.ocean.dolphin.getIncomingFavoriteRequests().filter(e=>!this.q.os.utilities.inArray(this.q.os.ocean.dolphin.getChannelNameList(),e.channel)),V=this.q.os.bee.config.getFavoriteFolderIDList(),this.database.filter(""),e.length>0&&this.q.os.bee.config.getExpandedFavoriteFolderItems().length>0&&(console.log("got a saved state!"),this.expandedNodes=this.q.os.bee.config.getExpandedFavoriteFolderItems(),this.restoreExpandedNodes()),this.updateNames()}saveExpandedNodes(){this.sENwriteBlock=1,this.expandedNodes=[];for(let e=0;e<this.treeControl.dataNodes.length;e++){let t=this.treeControl.dataNodes[e];t.expandable&&this.treeControl.isExpanded(t)&&this.expandedNodes.push(t)}return console.log("ChannelList: Persisting expanded folders..."),this.q.os.bee.config.setExpandedFavoriteFolderItems(this.expandedNodes),this.sENwriteBlock=0,!0}buildFavoriteFolderListFromTreeNodeData(){console.log("!!!!!"),console.log(this.database.data);let e=this.database.data;e=e.filter(e=>"emptyFolder"!=e.item);let t=[];for(let n=0;n<e.length;n++){console.log(e[n]);let i="dir";e[n].item.indexOf("-----")>-1&&(i="channel"),console.log(i);let o=[];void 0!==e[n].children&&e[n].children.length>0&&(o=this.getFavoriteFolderListTreeChildrenRec(e[n].children)),t.push({id:e[n].item,data:{name:this.q.os.bee.config.getFavoriteFolderNameFromId(e[n].item),kind:i,items:0},children:o})}return this.q.os.bee.config.setFavoriteFolderList(t),!0}selectChannel(e){console.log("ChannelList: Trying to select: >>"+e.trim()),this.q.os.utilities.inArray(this.q.os.ocean.dolphin.getChannelNameList(),e.trim())&&(console.log("ChannelList: Selecting: ",e.trim()),this.q.os.channel.select(e.trim()),this.q.os.ui.getSideBarFixed().left&&this.q.os.ui.hideSideBar("left"),this.cd.detectChanges())}getSelected(){return JSON.stringify(this.selectedChannel)}getFavoriteFolderListTreeChildrenRec(e){let t=[];for(let n=0;n<e.length;n++){console.log(e[n]);let i="dir";e[n].item.indexOf("-----")>-1&&(i="channel");let o=[];void 0!==e[n].children&&e[n].children.length>0&&(o=this.getFavoriteFolderListTreeChildrenRec(e[n].children)),t.push({id:e[n].item,data:{name:this.q.os.bee.config.getFavoriteFolderNameFromId(e[n].item),kind:i,items:0},children:o})}return t}restoreExpandedNodes(){this.sENwriteBlock=1;for(let e=0;e<this.expandedNodes.length;e++){let t=this.expandedNodes[e];console.log(t),console.log(this.treeControl.dataNodes),this.treeControl.expand(this.treeControl.dataNodes.find(e=>e.item===t.item))}this.sENwriteBlock=0}onCamerasFound(e){this.availableDevices=e,this.hasDevices=Boolean(e&&e.length)}onDeviceSelectChange(e){const t=this.availableDevices.find(t=>t.deviceId===e);this.currentDevice=t||null}onHasPermission(e){this.hasPermission=e}onTorchCompatible(e){this.torchAvailable$.next(e||!1)}toggleTorch(){this.torchEnabled=!this.torchEnabled}toggleTryHarder(){this.tryHarder=!this.tryHarder}qrSuccessHandler(e){console.log(e),this.inviteCodeHex=e,this.closePopup()}getFavoriteFolderList(){return this.favoriteFolderList=this.q.os.bee.config.getFavoriteFolderList(),this.favoriteFolderListArray=[],this.parseStructure(this.favoriteFolderList),this.favoriteFolderListArray.length>0&&(this.newFavoriteFolder=this.favoriteFolderListArray[0]),this.favoriteFolderList}parseStructure(e){for(let t=0;t<e.length;t++)-1===e[t].data.name.indexOf("-----")&&"emptyFolder"!=e[t].data.name&&(this.favoriteFolderListArray.push(e[t]),void 0!==e[t].children&&this.parseStructure(e[t].children));return e}newChannelFolderChanged(){}createNewChannel(e){return Object(i.a)(this,void 0,void 0,(function*(){}))}open(e){this.popupRef.push(this.dialog.open(e,{context:"this is some additional data passed to dialog"}))}closePopup(){console.log("close toggled"),this.popupRef[this.popupRef.length-1].close(),this.popupRef.pop()}createCompleteAndClose(){this.ui.delay(1e3),this.q.os.bee.config.commit(),this.ui.showSnack("Success!","Yesss",{duration:1e3}),this.closePopup()}createNewFavoriteFolder(e){this.saveExpandedNodes(),this.ui.showSnack("Creating Folder...","Please Wait");let t=this.newFavoriteFolderId;"object"==typeof t&&(t=""),this.q.os.bee.config.createFavoriteFolder(e,t),this.createCompleteAndClose()}deleteFolder(e){console.log("Deleting Folder..."),console.log(e);let t=this.q.os.bee.config.checkIfFavoriteFolderIdChannels(e);console.log(t),t?this.ui.showSnack("Folder has channels!","Sorry but no.",{duration:5e3}):(this.ui.showSnack("Deleting Folder...","Please Wait"),this.saveExpandedNodes(),this.q.os.bee.config.deleteFavoriteFolder(e),this.createCompleteAndClose())}importChannelFolderChanged(){}importNewChannel(t="NoInviteSelected"){return Object(i.a)(this,void 0,void 0,(function*(){this.saveExpandedNodes(),this.ui.showSnack("Importing Channel...","Please Wait"),"NoInviteSelected"==t&&(t=this.inviteCodeHex);let n,i,o=e.from(t,"hex").toString("utf8"),s=o.split("/////");s.length>0?(n=s[s.length-1].split(":")[0],i=s[s.length-1].split(":")[1],s.pop()):(n=o.split(":")[0],i=o.split(":")[1]);let a=this.newFavoriteFolder;"object"!=typeof a&&void 0!==a&&null!=typeof a||(a=""),this.q.os.utilities.inArray(this.q.os.ocean.dolphin.getChannelNameList(),n)?this.ui.showSnack("Channel Exists!","Oops",{duration:1e3}):(this.q.os.ocean.dolphin.removeIncomingFavoriteRequest(n.split("-----")[0].split("-")[1]),this.q.os.social.profile.addFavorite(n.split("-----")[0].split("-")[1]),console.log("ChannelFavorites: Adding Favorite: ",n.split("-----")[0].split("-")[1]),yield this.q.os.channel.import(n,s,"",i,0),this.createCompleteAndClose())}))}rejectRequest(e){this.q.os.ocean.dolphin.removeIncomingFavoriteRequest(e),this.saveExpandedNodes(),this.loadChannels(this.favoriteFolderList),this.q.os.commitNow()}newInviteImportFoldersChanged(){}goToProfile(e){this.ngZone.run(()=>this.router.navigate(["/social/profile/"+e]))}updateNames(){return Object(i.a)(this,void 0,void 0,(function*(){let e=[];for(let t of this.flatChannelNeeded)if(e.indexOf(t)<0){let n=yield this.q.os.social.getAliasFromDirectChannel(t);console.log(n),e.push(t),this.flatChannelNameList[t]=n}for(let t of this.flatChannelNeeded2)if(e.indexOf(t)<0){let n=yield this.q.os.social.getAliasFromDirectChannel2(t);console.log(n),e.push(t),this.flatChannelNameList2[t]=n}this.cd.detectChanges()}))}getAliasFromDirectChannel(e){return this.flatChannelNeeded.push(e),void 0!==this.flatChannelNameList[e]?this.flatChannelNameList[e]:e}getAliasFromDirectChannel2(e){return this.flatChannelNeeded2.push(e),void 0!==this.flatChannelNameList2[e]?this.flatChannelNameList2[e]:e}}return t.\u0275fac=function(e){return new(e||t)(h.Sb(g.c),h.Sb(h.C),h.Sb(h.h),h.Sb(Z),h.Sb(u.a),h.Sb(p.l),h.Sb(p.y),h.Sb(b.a))},t.\u0275cmp=h.Mb({type:t,selectors:[["messages-channel-favorites"]],viewQuery:function(e,t){var n;1&e&&(h.Mc(d.d,!0),h.Mc(k,!0),h.Mc(O,!0),h.Mc(N,!0),h.Mc(P,!0)),2&e&&(h.uc(n=h.gc())&&(t.contextMenu=n.first),h.uc(n=h.gc())&&(t.emptyItem=n.first),h.uc(n=h.gc())&&(t.qrPop=n.first),h.uc(n=h.gc())&&(t.createPop=n.first),h.uc(n=h.gc())&&(t.newFavoriteFolderPop=n.first))},features:[h.Eb([Z])],decls:22,vars:10,consts:[["createPop",""],["qrPop",""],["import",""],["newFavoriteFolder",""],[2,"width","169px","margin-top","20px","color","#598adb"],["matInput","","placeholder","Search",3,"input"],["outline","","size","small",1,"addChannelButton",3,"nbContextMenu"],["icon","plus-outline",2,"font-size","18px","width","auto"],["class","favoriteRequest",4,"ngFor","ngForOf"],[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",3,"ngClass","dragover","dragend","drop","click",4,"matTreeNodeDef"],["matTreeNodePadding","",3,"ngClass","dragover","dragend","drop",4,"matTreeNodeDef","matTreeNodeDefWhen"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],["contextMenu","matMenu"],["matMenuContent",""],["emptyItem",""],[2,"color","goldenrod"],[2,"padding","20px"],[2,"width","80%","margin-left","10px",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[2,"padding","20px","padding-bottom","34px","padding-top","0px","color","white !important"],["matInput","","placeholder","Channel Name","value","","name","newChannelName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange"],["mat-stroked-button","","color","primary",2,"margin-right","20px","border","1px solid #ffffff24",3,"click"],["mat-stroked-button","","color","primary",2,"border","1px solid #ffffff24",3,"click"],[3,"value"],[1,"qrScanWrapper"],[3,"torch","device","formats","tryHarder","deviceChange","scanSuccess","permissionResponse","camerasFound","torchCompatible"],[2,"width","19%"],[3,"value","valueChange","selectionChange"],["matInput","","placeholder","Invite Code","value","","name","inviteCodeHex",2,"color","black","background-color","goldenrod","padding","7px","margin-right","5%","width","80%",3,"ngModel","ngModelChange"],["icon","camera-outline",1,"deleteCode","scanQRCode",3,"click"],["matInput","","placeholder","Folder Name","value","","name","newFavoriteFolderName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange"],[1,"favoriteRequest"],["class","favoriteRequestText",3,"click",4,"ngIf"],["icon","close-square-outline",2,"color","#ff0000bd","float","right","cursor","pointer",3,"click"],["icon","checkmark-square-2-outline",2,"color","#16eb16","float","right","cursor","pointer",3,"click"],[1,"favoriteRequestText",3,"click"],["matTreeNodeToggle","","matTreeNodePadding","",3,"ngClass","dragover","dragend","drop","click"],[3,"class","active-channel",4,"ngIf"],["icon","activity"],["draggable","true",1,"checklist-leaf-node",3,"dragstart"],[1,"nodeContent",2,"width","100%",3,"ngClass"],["icon","question-mark-outline"],[1,"nodeContent","unknown",2,"width","100%",3,"ngClass"],["matTreeNodePadding","",3,"ngClass","dragover","dragend","drop"],[1,"treeNodeContainerFolder",3,"contextmenu"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],["icon","folder-outline"],[1,"nodeContent",3,"ngClass"],["mat-menu-item","",3,"click"]],template:function(e,t){if(1&e&&(h.Gc(0,X,15,3,"ng-template",null,0,h.Hc),h.Gc(2,Y,9,4,"ng-template",null,1,h.Hc),h.Gc(4,q,24,6,"ng-template",null,2,h.Hc),h.Gc(6,E,15,3,"ng-template",null,3,h.Hc),h.Yb(8,"mat-form-field",4),h.Yb(9,"input",5),h.fc("input",(function(e){return t.filterChanged(e.target.value)})),h.Xb(),h.Xb(),h.Yb(10,"button",6),h.Tb(11,"nb-icon",7),h.Xb(),h.Gc(12,L,5,2,"div",8),h.Yb(13,"mat-tree",9),h.Gc(14,K,3,3,"mat-tree-node",10),h.Gc(15,G,9,7,"mat-tree-node",11),h.Xb(),h.Tb(16,"div",12),h.Yb(17,"mat-menu",null,13),h.Gc(19,z,6,0,"ng-template",14),h.Xb(),h.Tb(20,"span",null,15)),2&e){const e=h.vc(18);h.Fb(10),h.pc("nbContextMenu",t.items),h.Fb(2),h.pc("ngForOf",t.incomingFavoriteRequestList),h.Fb(1),h.pc("dataSource",t.dataSource)("treeControl",t.treeControl),h.Fb(2),h.pc("matTreeNodeDefWhen",t.hasChild),h.Fb(1),h.Dc("left",t.contextMenuPosition.x)("top",t.contextMenuPosition.y),h.pc("matMenuTriggerFor",e)}},directives:[f.b,m.a,p.i,p.o,v.l,l.a,l.f,d.d,d.e,d.a,p.d,p.f,p.c,C.a,F.b,F.j,F.m,p.e,x.a,y.g,S.a,v.m,l.e,l.h,l.g,v.k,w.a,I.a,d.b],styles:["button[nbTreeGridRowToggle][_ngcontent-%COMP%]{background:transparent;border:none;padding:0}.search-label[_ngcontent-%COMP%]{display:block}.search-input[_ngcontent-%COMP%]{background:transparent;color:#fff;padding:5px;font-size:12px;width:100%;margin-top:1rem;margin-bottom:1rem;width:78%;margin-left:1%}.addChannelButton[_ngcontent-%COMP%]{color:rgba(134,116,183,.7490196078431373);margin-left:5%;position:relative;top:1px;background-color:#45267d;border:1px solid;border-radius:5px;padding:4px;opacity:.7}.nb-column-name[_ngcontent-%COMP%]{width:80%}.nb-column-items[_ngcontent-%COMP%]{width:20%}.favoriteRequest[_ngcontent-%COMP%]{width:100%;overflow:hidden;white-space:nowrap;padding:10px;border-radius:5px;background:rgba(120,14,62,.6392156862745098);font-family:Ubuntu;font-size:14px;margin-bottom:5px}.favoriteRequestText[_ngcontent-%COMP%]{width:80%;cursor:pointer;overflow:hidden;width:66%;float:left;text-overflow:ellipsis;color:hsla(0,0%,100%,.7490196078431373)}.scanQRCode[_ngcontent-%COMP%]{font-size:37px;color:#315cdf;cursor:pointer}.scanQRCode[_ngcontent-%COMP%]:hover{color:#4a81e6}[_nghost-%COMP%]   nb-layout-header[_ngcontent-%COMP%]     nav{justify-content:flex-end}.mat-tree[_ngcontent-%COMP%], .mat-tree-node[_ngcontent-%COMP%]{background:transparent}.mat-tree-node[_ngcontent-%COMP%]{overflow:visible;cursor:move}.drop-above[_ngcontent-%COMP%]{border-top:10px solid #2196f3;margin-top:-10px}.drop-below[_ngcontent-%COMP%]{border-bottom:10px solid #2196f3;margin-bottom:-10px}.drop-center[_ngcontent-%COMP%]{background-color:#a9a9a9}.drag-start[_ngcontent-%COMP%]{background-color:#1565c0;color:#f0fff0}.treeNodeContainerFolder[_ngcontent-%COMP%]{background-color:rgba(131,119,230,.058823529411764705);padding:0 16px 0 0}.treeNodeContainerFolder[_ngcontent-%COMP%], .treeNodeContainerSingle[_ngcontent-%COMP%]{border-radius:5px;margin:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.treeNodeContainerSingle[_ngcontent-%COMP%]{background-color:rgba(69,39,128,.3686274509803922);padding:6px 10px 6px 15px}.mat-tree[_ngcontent-%COMP%]{width:227px;left:14px;top:190px;bottom:40px;position:fixed;overflow:scroll}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3)}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:rgba(78,132,229,.5607843137254902);outline:0}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:none!important}.emptyFolder[_ngcontent-%COMP%]{display:none}.mat-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .mat-icon-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{line-height:20px}.qrScanWrapper[_ngcontent-%COMP%]{min-width:20px;max-height:80vh;max-width:37vw}.mat-tree[_ngcontent-%COMP%]{z-index:999;max-width:227px;left:-1px;padding-right:10px;position:relative;top:0;margin-bottom:40px}.nodeContent.station[_ngcontent-%COMP%], .nodeContent.unknown[_ngcontent-%COMP%]{position:relative;top:-1px}"]}),t})()}).call(this,n("tjlA").Buffer)},"8A8W":function(e,t,n){"use strict";n.r(t),n.d(t,"QDMessagesModule",(function(){return Fe}));var i=n("tyNb"),o=n("fXoL"),s=n("n2fA"),a=n("Witw"),c=n("aceb"),r=n("gvxT"),l=n("ofXK"),d=n("bTqV"),h=n("rk8u"),g=n("/on3");let u=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Mb({type:e,selectors:[["messages-channel-sidebar-left"]],decls:5,vars:0,consts:[["fullWidth",""],["tabIcon","activity-outline",1,"channelList"],["tabIcon","star-outline",1,"channelList","favoriteTab"]],template:function(e,t){1&e&&(o.Yb(0,"nb-tabset",0),o.Yb(1,"nb-tab",1),o.Tb(2,"messages-channel-list"),o.Xb(),o.Yb(3,"nb-tab",2),o.Tb(4,"messages-channel-favorites"),o.Xb(),o.Xb())},directives:[c.H,c.G,h.a,g.a],styles:[".favoriteTab[_ngcontent-%COMP%]{overflow:hidden!important;overflow-y:auto!important}"]}),e})();var p=n("Cjz3"),b=n("5+WD"),f=n("SS7q"),m=n("qFsG"),v=n("3Pt+");const C=["folder"],F=["folderEdit"],x=["participantEdit"];function y(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-card"),o.Yb(1,"nb-card-header"),o.Ic(2,"Create Participant Folder"),o.Xb(),o.Yb(3,"nb-card-body",6),o.Yb(4,"div",7),o.Yb(5,"input",8),o.fc("ngModelChange",(function(t){return o.xc(e),o.jc().newFolderName=t})),o.Xb(),o.Xb(),o.Xb(),o.Yb(6,"nb-card-footer"),o.Yb(7,"button",9),o.fc("click",(function(){o.xc(e);const t=o.jc();return t.createFolder(t.newFolderName)})),o.Ic(8,"Create"),o.Xb(),o.Yb(9,"button",10),o.fc("click",(function(){return o.xc(e),o.jc().closePopup()})),o.Ic(10,"Cancel"),o.Xb(),o.Xb(),o.Xb()}if(2&e){const e=o.jc();o.Fb(5),o.pc("ngModel",e.newFolderName)}}function S(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-card"),o.Yb(1,"nb-card-header"),o.Ic(2,"Edit Folder"),o.Xb(),o.Yb(3,"nb-card-body",6),o.Yb(4,"div",7),o.Yb(5,"input",11),o.fc("ngModelChange",(function(t){return o.xc(e),o.jc().editedFolderName=t})),o.Xb(),o.Xb(),o.Xb(),o.Yb(6,"nb-card-footer"),o.Yb(7,"button",9),o.fc("click",(function(){o.xc(e);const t=o.jc();return t.editFolder(t.editedFolderId,t.editedFolderName)})),o.Ic(8,"Create"),o.Xb(),o.Yb(9,"button",10),o.fc("click",(function(){return o.xc(e),o.jc().closePopup()})),o.Ic(10,"Cancel"),o.Xb(),o.Xb(),o.Xb()}if(2&e){const e=o.jc();o.Fb(5),o.pc("ngModel",e.editedFolderName)}}function w(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-card"),o.Yb(1,"nb-card-header"),o.Ic(2,"Edit Participant"),o.Xb(),o.Yb(3,"nb-card-body",6),o.Yb(4,"div",7),o.Yb(5,"input",12),o.fc("ngModelChange",(function(t){return o.xc(e),o.jc().editedParticipantName=t})),o.Xb(),o.Xb(),o.Xb(),o.Yb(6,"nb-card-footer"),o.Yb(7,"button",9),o.fc("click",(function(){o.xc(e);const t=o.jc();return t.editParticipant(t.editedParticipantId,t.editedParticipantName)})),o.Ic(8,"Create"),o.Xb(),o.Yb(9,"button",10),o.fc("click",(function(){return o.xc(e),o.jc().closePopup()})),o.Ic(10,"Cancel"),o.Xb(),o.Xb(),o.Xb()}if(2&e){const e=o.jc();o.Fb(5),o.pc("ngModel",e.editedParticipantName)}}function I(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-icon",21),o.fc("click",(function(){o.xc(e);const t=o.jc(2);return t.openPopup(t.folderPop)})),o.Xb()}}function k(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-icon",22),o.fc("click",(function(){o.xc(e);const t=o.jc().$implicit;return o.jc().removeFolder(t.id)})),o.Xb()}}function O(e,t){if(1&e){const e=o.Zb();o.Yb(0,"div",23),o.fc("click",(function(t){return o.xc(e),o.jc(2).clickParticipant(t)})),o.Yb(1,"span",24),o.fc("click",(function(){o.xc(e);const n=t.$implicit;return o.jc(2).openSocialProfile(n.name,n.pubKey)})),o.Ic(2),o.Xb(),o.Yb(3,"nb-icon",25),o.fc("click",(function(){o.xc(e);const n=t.$implicit,i=o.jc().$implicit,s=o.jc();return s.openPopup(s.participantEditPop,i.id,n.pubKey)})),o.Xb(),o.Xb()}if(2&e){const e=t.$implicit,n=o.jc(2);o.Ib("item-box participantEntry ",n.isOnline(e.pubKey),""),o.Fb(2),o.Jc(e.name)}}function N(e,t){if(1&e){const e=o.Zb();o.Yb(0,"div",13),o.Yb(1,"div",14),o.Yb(2,"div",15),o.Ic(3),o.Gc(4,I,1,0,"nb-icon",16),o.Gc(5,k,1,0,"nb-icon",17),o.Yb(6,"nb-icon",18),o.fc("click",(function(){o.xc(e);const n=t.$implicit,i=o.jc();return i.openPopup(i.folderEditPop,n.id)})),o.Xb(),o.Xb(),o.Yb(7,"div",19),o.fc("cdkDropListDropped",(function(t){return o.xc(e),o.jc().drop(t)})),o.Gc(8,O,4,4,"div",20),o.Xb(),o.Xb(),o.Xb()}if(2&e){const e=t.$implicit,n=o.jc();o.Fb(3),o.Kc("",e.name," "),o.Fb(1),o.pc("ngIf",e.participants.length>0||"others"==e.id),o.Fb(1),o.pc("ngIf",0==e.participants.length&&"others"!=e.id),o.Fb(2),o.qc("id",e.id),o.pc("cdkDropListData",e.participants)("cdkDropListConnectedTo",n.connectedTo),o.Fb(1),o.pc("ngForOf",e.participants)}}function P(e,t){1&e&&(o.Yb(0,"div",26),o.Ic(1," Waiting... "),o.Xb())}let M=(()=>{class e{constructor(e,t,n,i,o,s){this.ngZone=e,this.router=t,this.cd=n,this.q=i,this.ui=o,this.dialog=s,this.channel="NoChannelSelected",this.folders=[],this.connectedTo=[],this.channelParticipantListArray=[],this.popupRef=[],this.dev=!1,this.noChannelSelected="NoChannelSelected",this.dev=!1}clickParticipant(e){this.dev&&console.log(e)}isOnline(e){return this.q.os.channel.isPeerOnline(e)}sortFoldersByName(e){e.sort((function(e,t){return e.name.localeCompare(t.name)}));let t=e.filter(e=>"others"==e.id);return e=e.filter(e=>"others"!=e.id),void 0!==t[0]&&e.push(t[0]),e}drop(e){e.previousContainer===e.container?Object(b.d)(e.container.data,e.previousIndex,e.currentIndex):Object(b.e)(e.previousContainer.data,e.container.data,e.previousIndex,e.currentIndex),this.q.os.channel.setParticipantFolders(this.channel,this.folders)}ngOnDestroy(){clearInterval(this.uiCheck),this.selectedChannelSub.unsubscribe()}getFolderNameForId(e){for(let t=0;t<this.folders.length;t++)if(this.folders[t].id==e)return this.folders[t].name}openSocialProfile(e,t){return Object(s.a)(this,void 0,void 0,(function*(){if("Anonymous"==e)return!1;let n=yield this.q.os.social.profile.getByChannelPubKey(t);n=n.key.pubKey,this.dev&&console.log(n),this.ngZone.run(()=>this.router.navigate(["/social/profile/"+n]))}))}getParticipantNameForId(e){for(let t=0;t<this.folders.length;t++)for(let n=0;n<this.folders[t].participants.length;n++)if(this.folders[t].participants[n].pubKey==e)return this.folders[t].participants[n].name}createFolder(e){this.folders.push({id:Object(f.a)(),name:e,participants:[]}),this.folders=this.sortFoldersByName(this.folders),this.connectedTo=[];for(let t=0;t<this.folders.length;t++)this.connectedTo.push(this.folders[t].id);this.q.os.channel.setParticipantFolders(this.channel,this.folders),this.closePopup()}removeFolder(e){this.folders=this.sortFoldersByName(this.folders.filter(t=>t.id!=e));for(let t=0;t<this.folders.length;t++)this.connectedTo.push(this.folders[t].id);this.q.os.channel.setParticipantFolders(this.channel,this.folders)}editFolder(e,t){this.connectedTo=[];for(let n=0;n<this.folders.length;n++)this.folders[n].id==e&&(this.folders[n].name=this.editedFolderName);this.folders=this.sortFoldersByName(this.folders);for(let n=0;n<this.folders.length;n++)this.connectedTo.push(this.folders[n].id);this.q.os.channel.setParticipantFolders(this.channel,this.folders),this.closePopup()}editParticipant(e,t){this.connectedTo=[];for(let n=0;n<this.folders.length;n++){for(let e=0;e<this.folders[n].participants.length;e++)this.folders[n].participants[e].pubKey==this.editedParticipantId&&(this.folders[n].participants[e].nick=this.editedParticipantName);this.connectedTo.push(this.folders[n].id)}this.q.os.channel.setParticipantFolders(this.channel,this.folders),this.closePopup()}openPopup(e,t="",n=""){""!=t&&(this.editedFolderId=t,this.editedFolderName=this.getFolderNameForId(t)),""!=n&&(this.editedParticipantId=n,this.editedParticipantName=this.getParticipantNameForId(n)),this.popupRef.push(this.dialog.open(e,{context:"this is some additional data passed to dialog"}))}closePopup(){console.log("close toggled"),this.popupRef[this.popupRef.length-1].close(),this.popupRef.pop()}initRefresh(e=!0){return Object(s.a)(this,void 0,void 0,(function*(){yield this.q.os.utilities.delay(2e3),this.cd.detectChanges(),yield this.q.os.utilities.delay(2e3),this.cd.detectChanges(),yield this.q.os.utilities.delay(2e3),this.cd.detectChanges(),e&&(yield this.q.os.utilities.delay(2e3),this.initRefresh(!1))}))}initProcess(){return Object(s.a)(this,void 0,void 0,(function*(){this.channel=this.q.os.channel.getSelected();let e=this.channel,t=!1;if("NoChannelSelected"!=e)try{let i=this.q.os.ocean.dolphin.getChannelParticipantList(e);if(void 0===i.cList)throw this.q.os.channel.sayHi(e),t=!0,"no list";let o=i.cList.split(","),s=o;if(this.connectedTo=[],this.folders=[],o.length>0){let t=this.q.os.channel.getParticipantFolders(e);if(this.folders=[],t.length>0){for(let i=0;i<t.length;i++)for(let s=0;s<t[i].participants.length;s++){if(void 0!==t[i].participants[s].nick&&""!=t[i].participants[s].nick)t[i].participants[s].name=t[i].participants[s].nick;else{let o;try{console.log("ChannelParticipantList: Getting Profile For Foldered Participant..."),o=yield this.q.os.social.profile.getByChannelPubKey(t[i].participants[s].pubKey)}catch(n){console.log(n)}if(void 0!==o&&void 0!==o.alias){let n=!1,a=!1;if(e.indexOf("qprivatedch")>-1&&this.q.os.social.profile.isRequestedFavorite(o.key.pubKey))this.q.os.social.profile.addFavorite(o.key.pubKey),n=!0,this.q.os.social.profile.removeFavoriteRequest(o.key.pubKey);else if(this.q.os.social.profile.isRequestedFavorite(o.key.pubKey)){let e=this.q.os.social.profile.getRequestedFavoriteChannel(o.key.pubKey),n={message:{invite:this.q.os.channel.invite.create(e,1),pubKey:yield this.q.os.social.profile.getMyProfileId(),channel:e},toChannelPubKey:t[i].participants[s].pubKey};this.isOnline(n.toChannelPubKey)&&this.q.os.channel.publish(this.channel,n,"REQUEST_FAVORITE"),a=!0}t[i].participants[s].name=o.alias,t[i].participants[s].isFavorite=n,t[i].participants[s].isRequestedFavorite=a}}o=o.filter(e=>e!=t[i].participants[s].pubKey)}this.folders=t}}else t||(this.q.os.channel.sayHi(e),t=!0);let a=[];this.dev&&console.log(o);for(let t=0;t<o.length;t++){let i;try{this.dev&&console.log("ChannelParticipantList: Getting Profile For Unfoldered Participant..."),i=yield this.q.os.social.profile.getByChannelPubKey(o[t]),this.dev&&console.log(o[t],i)}catch(n){console.log(n)}if(this.dev&&console.log(i),void 0!==i&&void 0!==i.alias){let n=!1,s=!1;if(e.indexOf("qprivatedch")>-1&&this.q.os.social.profile.isRequestedFavorite(i.key.pubKey))this.q.os.social.profile.addFavorite(i.key.pubKey),n=!0,this.q.os.social.profile.removeFavoriteRequest(i.key.pubKey);else if(this.q.os.social.profile.isRequestedFavorite(i.key.pubKey)){let e=this.q.os.social.profile.getRequestedFavoriteChannel(i.key.pubKey),n={invite:this.q.os.channel.invite.create(e,1),pubKey:yield this.q.os.social.profile.getMyProfileId(),channel:e};this.isOnline(o[t])&&this.q.os.channel.publish(this.channel,{message:n,toChannelPubKey:o[t]},"REQUEST_FAVORITE"),s=!0}a.push({pubKey:o[t],name:i.alias,isFavorite:n,isRequestedFavorite:s})}else a.push({pubKey:o[t],name:"Anonymous"})}let c=!1;for(let e=0;e<this.folders.length;e++)"others"==this.folders[e].id&&(this.folders[e].participants=this.folders[e].participants.concat(a),c=!0);c||this.folders.push({id:"others",name:"Crowd",participants:a}),this.folders=this.sortFoldersByName(this.folders);for(let e of this.folders)this.connectedTo.push(e.id);let r=(new Date).getTime();if(r-=18e4,(yield this.q.os.social.profile.isPublic())&&(void 0===this.sharedPublicSocialTimestamp||this.sharedPublicSocialTimestamp<r)){let e=!1;console.log("CPL: Checking who doesnt have my Social Profile...");for(let t of s)!(yield this.q.os.social.profile.hasMySocial(t))&&this.isOnline(t)&&(e=!0);if(e){console.log("CPL: Sharing Social Profile...");let e=yield this.q.os.social.profile.getMyProfile(),t=e.key.privKey,i={alias:e.alias,fullName:e.fullName,about:e.about,private:e.private,key:{pubKey:e.key.pubKey}},o={};try{o=yield this.q.os.social.timeline.getLatestRef(e.key.pubKey)}catch(n){console.log(n)}void 0!==o.qHash&&void 0!==o.whistle&&(i.timeline=o),console.log("SHARING"),this.dev&&console.log(t);let s={message:yield this.q.os.crypto.ec.sign(i,t)};this.dev&&console.log("qD Messages ChannelParticipantList: Publishing...",JSON.parse(JSON.stringify(s))),this.q.os.channel.publish(this.channel,s,"SHARE_PUBLIC_SOCIAL"),this.sharedPublicSocialTimestamp=(new Date).getTime()}}}catch(n){"no list"==n&&(this.folders=[]),console.log(n)}return this.cd.detectChanges(),!0}))}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){for(;!this.q.isReady()||!this.q.os.isSignedIn();)yield this.ui.delay(1e3);this.selectedChannelSub=this.q.os.channel.onSelect().subscribe(e=>{console.log("ChannelParticipantList: changed channel"),this.initProcess(),this.channel=e,console.log("App: Selected Channel: >>"+this.channel+"<<"),console.log("App: noChannelSelected: >>"+this.noChannelSelected+"<<")}),this.uiCheck=setInterval(()=>{this.initProcess()},2e4),yield this.initProcess()}))}}return e.\u0275fac=function(t){return new(t||e)(o.Sb(o.C),o.Sb(i.c),o.Sb(o.h),o.Sb(r.a),o.Sb(a.a),o.Sb(c.l))},e.\u0275cmp=o.Mb({type:e,selectors:[["messages-channel-participant-list"]],viewQuery:function(e,t){var n;1&e&&(o.Mc(C,!0),o.Mc(F,!0),o.Mc(x,!0)),2&e&&(o.uc(n=o.gc())&&(t.folderPop=n.first),o.uc(n=o.gc())&&(t.folderEditPop=n.first),o.uc(n=o.gc())&&(t.participantEditPop=n.first))},decls:10,vars:2,consts:[["folder",""],["folderEdit",""],["participantEdit",""],["class","col-md-3",4,"ngFor","ngForOf"],["class","syncingItem",4,"ngIf"],[1,"spacer"],[2,"color","goldenrod"],[2,"padding","20px","color","white !important"],["matInput","","placeholder","Folder Name","value","","name","newFolderName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange"],["mat-stroked-button","","color","primary",2,"margin-right","20px","border","1px solid #ffffff24",3,"click"],["mat-stroked-button","","color","primary",2,"border","1px solid #ffffff24",3,"click"],["matInput","","placeholder","Folder Name","value","","name","editedFolderName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange"],["matInput","","placeholder","Participant Name","value","","name","editedParticipantName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange"],[1,"col-md-3"],[1,"drag-container"],[1,"section-heading"],["icon","plus-outline","class","folderIcon",3,"click",4,"ngIf"],["icon","close-outline","class","folderIcon",3,"click",4,"ngIf"],["icon","edit-2-outline",1,"folderIcon","editIcon",3,"click"],["cdkDropList","",1,"item-list",3,"id","cdkDropListData","cdkDropListConnectedTo","cdkDropListDropped"],["cdkDrag","",3,"class","click",4,"ngFor","ngForOf"],["icon","plus-outline",1,"folderIcon",3,"click"],["icon","close-outline",1,"folderIcon",3,"click"],["cdkDrag","",3,"click"],[1,"participantName",3,"click"],["icon","options-2-outline",1,"participantIcon","participantSettingsIcon",3,"click"],[1,"syncingItem"]],template:function(e,t){1&e&&(o.Gc(0,y,11,1,"ng-template",null,0,o.Hc),o.Gc(2,S,11,1,"ng-template",null,1,o.Hc),o.Gc(4,w,11,1,"ng-template",null,2,o.Hc),o.Gc(6,N,9,7,"div",3),o.Gc(7,P,2,0,"div",4),o.Yb(8,"div",5),o.Ic(9,"\xa0"),o.Xb()),2&e&&(o.Fb(6),o.pc("ngForOf",t.folders),o.Fb(1),o.pc("ngIf",0===t.folders.length))},directives:[l.l,l.m,c.d,c.f,c.c,m.a,v.b,v.j,v.m,c.e,d.a,c.o,b.b,b.a],styles:[".section-heading[_ngcontent-%COMP%]{padding:5px 10px}.drag-container[_ngcontent-%COMP%]{margin:0 25px 25px 0}.item-list[_ngcontent-%COMP%]{min-height:60px;border-radius:4px;display:block}.participant[_ngcontent-%COMP%]{background:#0084ff;background-image:linear-gradient(319deg,#fce055,#256eff 37%,#46237a);color:#fff;margin:0}.participantEntry.false[_ngcontent-%COMP%]{opacity:.3}.item-box[_ngcontent-%COMP%], .participantName[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.item-box[_ngcontent-%COMP%]{font-size:14px;background:#0084ff;background-image:linear-gradient(319deg,#fce055,#256eff 37%,#46237a);color:#fff;font-family:MONOSPACE;font-size:11px;padding:6px 10px;border:0;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;cursor:pointer;border-radius:8px;margin:0 0 5px;font-family:Ubuntu;font-size:12px}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12);border-radius:8px}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .item-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .item-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.drag-container[_ngcontent-%COMP%]{width:400px;max-width:100%;margin:0 0 10px;display:inline-block;vertical-align:top;background-color:rgba(233,236,239,.0196078431372549);padding:15px;border-radius:10px}.section-heading[_ngcontent-%COMP%]{padding-bottom:9px;padding-left:7px;padding-top:0;font-size:15px;font-weight:700;color:#d6d649}.spacer[_ngcontent-%COMP%]{min-height:40px}.editIcon[_ngcontent-%COMP%]{margin-right:10px}.folderIcon[_ngcontent-%COMP%], .participantIcon[_ngcontent-%COMP%]{float:right;font-size:17px;color:#3375f6;cursor:pointer}.syncingItem[_ngcontent-%COMP%]{position:relative;top:20px;text-align:center;color:red}"]}),e})();var X=n("jhN1"),Y=n("kmnG"),j=n("d3UM"),q=n("FKr1"),T=n("UXJo");const E=["qrCode"];function B(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-card"),o.Yb(1,"nb-card-header"),o.Ic(2,"Scan QR"),o.Xb(),o.Yb(3,"nb-card-body",13),o.Yb(4,"div"),o.Yb(5,"div",14),o.Tb(6,"img",15),o.Xb(),o.Xb(),o.Xb(),o.Yb(7,"nb-card-footer"),o.Yb(8,"button",16),o.fc("click",(function(){return o.xc(e),o.jc().closePopup()})),o.Ic(9,"Close"),o.Xb(),o.Xb(),o.Xb()}if(2&e){const e=o.jc();o.Fb(6),o.pc("src",e.qrCodeURLSafe,o.zc)}}function D(e,t){if(1&e){const e=o.Zb();o.Yb(0,"li",17),o.Yb(1,"div",18),o.Ic(2),o.Xb(),o.Yb(3,"div",19),o.Ic(4),o.Xb(),o.Tb(5,"nb-icon",20),o.Yb(6,"nb-icon",21),o.fc("click",(function(){o.xc(e);const n=t.$implicit;return o.jc().showQR(n.link)})),o.Xb(),o.Yb(7,"nb-icon",22),o.fc("click",(function(){o.xc(e);const n=t.$implicit;return o.jc().removeInviteCode(n.link)})),o.Xb(),o.Xb()}if(2&e){const e=t.$implicit;o.Fb(2),o.Lc(" ",e.used," / ",e.max," "),o.Fb(2),o.Kc(" ",e.link," "),o.Fb(1),o.pc("cdkCopyToClipboard",e.link)}}function L(e,t){if(1&e){const e=o.Zb();o.Yb(0,"button",23),o.fc("click",(function(){return o.xc(e),o.jc().deleteCurrentChannel()})),o.Ic(1,"Remove Channel"),o.Xb()}}function _(e,t){if(1&e){const e=o.Zb();o.Yb(0,"button",23),o.fc("click",(function(){return o.xc(e),o.jc().removeFromFavoritesByCurrentChannel()})),o.Ic(1,"Remove From Favorites"),o.Xb()}}let R=(()=>{class e{constructor(e,t,n,i,o,s){this.cd=e,this._sanitizer=t,this.ui=n,this.dialog=i,this.nbMenuService=o,this.q=s,this.challengeFlowFlag=0,this.newInviteCodeMax=5,this.isOwner=!1,this.includeFolderStructure=1,this.channelInviteCodes=[],this.selectedChannel="NoChannelSelected",this.noChannelSelected="NoChannelSelected"}newInviteCodeMaxChanged(e){}generateQR(e){return Object(s.a)(this,void 0,void 0,(function*(){console.log(e),this.qrCodeURLSafe=this._sanitizer.bypassSecurityTrustUrl(yield this.q.os.utilities.qr.generate(e))}))}generateInviteCode(){let e,t=this.selectedChannel;e=1==this.includeFolderStructure?this.q.os.channel.invite.create(t,this.newInviteCodeMax,!0):this.q.os.channel.invite.create(t,this.newInviteCodeMax);let n=this.q.os.ocean.dolphin.getInviteCodes(this.selectedChannel);this.channelInviteCodes=[],void 0!==n&&void 0!==n.items&&(this.channelInviteCodes=n.items)}openPopup(e){this.popupRef=this.dialog.open(e,{context:"this is some additional data passed to dialog"})}closePopup(){this.popupRef.close()}showQR(e){this.generateQR(e),this.openPopup(this.qrCode)}removeInviteCode(e){this.q.os.channel.invite.remove(this.selectedChannel,e),this.channelInviteCodes=[];let t=this.q.os.ocean.dolphin.getInviteCodes(this.selectedChannel);void 0!==t&&void 0!==t.items&&(this.channelInviteCodes=t.items)}newInviteExportFoldersChanged(e){}copyToClipboard(e){console.log(e)}ngOnDestroy(){this.selectedChannelSub.unsubscribe()}initChannel(e){return Object(s.a)(this,void 0,void 0,(function*(){if(this.selectedChannel=e,console.log("Channel-Settings: Selected Channel: >>"+this.selectedChannel+"<<"),console.log("Channel-Settings: noChannelSelected: >>"+this.noChannelSelected+"<<"),this.selectedChannel.indexOf("-----")>-1){this.isOwner=this.q.os.ocean.dolphin.isOwner(this.selectedChannel),this.channelInviteCodes=[];let e=this.q.os.ocean.dolphin.getInviteCodes(this.selectedChannel);void 0!==e&&void 0!==e.items&&(this.channelInviteCodes=e.items),this.challengeFlowFlag=this.q.os.channel.challenge.isEnabled()}this.cd.detectChanges()}))}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){for(;!this.q.isReady();)yield this.ui.delay(1e3);this.initChannel(this.q.os.channel.getSelected()),this.selectedChannelSub=this.q.os.channel.onSelect().subscribe(e=>{this.initChannel(e)})}))}challengeFlowFlagChanged(){let e=this.challengeFlowFlag,t=this.q.os.channel.getSelected();e?this.q.os.channel.challenge.enable(t):this.q.os.channel.challenge.disable(t)}deleteCurrentChannel(){this.q.os.channel.remove(this.selectedChannel),this.q.os.channel.select("NoChannelSelected")}removeFromFavoritesByCurrentChannel(){let e=this.selectedChannel;this.q.os.social.profile.removeFavorite(e.split("-----")[0].split("-")[1]),this.q.os.social.profile.removeFavorite(e.split("-----")[0].split("-")[2]),this.q.os.channel.remove(e),this.q.os.channel.removeFromNameList(e),this.q.os.channel.select("NoChannelSelected")}}return e.\u0275fac=function(t){return new(t||e)(o.Sb(o.h),o.Sb(X.b),o.Sb(a.a),o.Sb(c.l),o.Sb(c.y),o.Sb(r.a))},e.\u0275cmp=o.Mb({type:e,selectors:[["messages-channel-settings"]],viewQuery:function(e,t){var n;1&e&&o.Mc(E,!0),2&e&&o.uc(n=o.gc())&&(t.qrCode=n.first)},decls:51,vars:21,consts:[["qrCode",""],[3,"hidden"],[1,"channelSettingsOption"],[2,"width","24%","padding","0"],[3,"value","valueChange","selectionChange"],[3,"value"],[1,"channelSettingsOption","mTop10"],[2,"margin-bottom","4px","height","28px"],[2,"width","19%"],[2,"width","24%"],["nbButton","","size","small",1,"generateInviteCodeButton",2,"color","#99aca2",3,"click"],["class","inviteCodeListItem",4,"ngFor","ngForOf"],["mat-stroked-button","","color","primary","class","defaultSettingsButton removeButton",3,"click",4,"ngIf"],[2,"margin","10px","color","goldenrod"],[1,"qrCodeWrapper"],["alt","",1,"qrCodeShowGenerate",3,"src"],["mat-stroked-button","","color","primary",2,"border","1px solid #ffffff24",3,"click"],[1,"inviteCodeListItem"],[1,"inviteCodeUsers"],[1,"inviteCodeItem"],["icon","copy-outline",1,"inviteCodeCopy",3,"cdkCopyToClipboard"],["icon","camera-outline",1,"deleteCode",3,"click"],["icon","trash-2-outline",1,"deleteCode",3,"click"],["mat-stroked-button","","color","primary",1,"defaultSettingsButton","removeButton",3,"click"]],template:function(e,t){1&e&&(o.Gc(0,B,10,1,"ng-template",null,0,o.Hc),o.Yb(2,"div",1),o.Yb(3,"p",2),o.Ic(4," Challenge"),o.Xb(),o.Yb(5,"mat-form-field",3),o.Yb(6,"mat-select",4),o.fc("valueChange",(function(e){return t.challengeFlowFlag=e}))("selectionChange",(function(){return t.challengeFlowFlagChanged()})),o.Yb(7,"mat-option",5),o.Ic(8," On "),o.Xb(),o.Yb(9,"mat-option",5),o.Ic(10," Off "),o.Xb(),o.Xb(),o.Xb(),o.Yb(11,"p",6),o.Ic(12," Invite Codes"),o.Xb(),o.Yb(13,"div",7),o.Ic(14," Include Folders: "),o.Yb(15,"mat-form-field",8),o.Yb(16,"mat-select",4),o.fc("valueChange",(function(e){return t.includeFolderStructure=e}))("selectionChange",(function(e){return t.newInviteExportFoldersChanged(e.value)})),o.Yb(17,"mat-option",5),o.Ic(18," On "),o.Xb(),o.Yb(19,"mat-option",5),o.Ic(20," Off "),o.Xb(),o.Xb(),o.Xb(),o.Xb(),o.Yb(21,"div"),o.Ic(22," Max: "),o.Yb(23,"mat-form-field",9),o.Yb(24,"mat-select",4),o.fc("valueChange",(function(e){return t.newInviteCodeMax=e}))("selectionChange",(function(e){return t.newInviteCodeMaxChanged(e.value)})),o.Yb(25,"mat-option",5),o.Ic(26," 1 "),o.Xb(),o.Yb(27,"mat-option",5),o.Ic(28," 5 "),o.Xb(),o.Yb(29,"mat-option",5),o.Ic(30," 10 "),o.Xb(),o.Yb(31,"mat-option",5),o.Ic(32," 20 "),o.Xb(),o.Yb(33,"mat-option",5),o.Ic(34," 40 "),o.Xb(),o.Yb(35,"mat-option",5),o.Ic(36," 80 "),o.Xb(),o.Yb(37,"mat-option",5),o.Ic(38," 100 "),o.Xb(),o.Yb(39,"mat-option",5),o.Ic(40," 1k "),o.Xb(),o.Yb(41,"mat-option",5),o.Ic(42," 1m "),o.Xb(),o.Yb(43,"mat-option",5),o.Ic(44," 10m "),o.Xb(),o.Xb(),o.Xb(),o.Yb(45,"button",10),o.fc("click",(function(){return t.generateInviteCode()})),o.Ic(46," Generate "),o.Xb(),o.Xb(),o.Yb(47,"ul"),o.Gc(48,D,8,4,"li",11),o.Xb(),o.Xb(),o.Gc(49,L,2,0,"button",12),o.Gc(50,_,2,0,"button",12)),2&e&&(o.Fb(2),o.pc("hidden",!t.isOwner||t.selectedChannel.indexOf("qprivatedch")>-1),o.Fb(4),o.pc("value",t.challengeFlowFlag),o.Fb(1),o.pc("value",1),o.Fb(2),o.pc("value",0),o.Fb(7),o.pc("value",t.includeFolderStructure),o.Fb(1),o.pc("value",1),o.Fb(2),o.pc("value",0),o.Fb(5),o.pc("value",t.newInviteCodeMax),o.Fb(1),o.pc("value",1),o.Fb(2),o.pc("value",5),o.Fb(2),o.pc("value",10),o.Fb(2),o.pc("value",20),o.Fb(2),o.pc("value",40),o.Fb(2),o.pc("value",80),o.Fb(2),o.pc("value",100),o.Fb(2),o.pc("value",1e3),o.Fb(2),o.pc("value",1e6),o.Fb(2),o.pc("value",1e7),o.Fb(5),o.pc("ngForOf",t.channelInviteCodes),o.Fb(1),o.pc("ngIf",t.selectedChannel.indexOf("qprivatedch")<0),o.Fb(1),o.pc("ngIf",t.selectedChannel.indexOf("qprivatedch")>-1))},directives:[Y.b,j.a,q.g,l.l,l.m,c.d,c.f,c.c,c.e,d.a,c.o,T.a],styles:[".channelSettingsOption[_ngcontent-%COMP%]{color:#98aba2!important;margin-bottom:0}.inviteCodeListItem[_ngcontent-%COMP%]{padding:0!important;margin:0!important;width:100%}.inviteCodeUsers[_ngcontent-%COMP%]{width:30%;overflow:hidden;text-overflow:ellipsis}.inviteCodeItem[_ngcontent-%COMP%], .inviteCodeUsers[_ngcontent-%COMP%]{float:left}.inviteCodeItem[_ngcontent-%COMP%]{margin-left:5px;width:30%;margin-right:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.deleteCode[_ngcontent-%COMP%]{margin-left:5px}.deleteCode[_ngcontent-%COMP%], .inviteCodeCopy[_ngcontent-%COMP%]{cursor:pointer}.generateInviteCodeButton[_ngcontent-%COMP%]{margin-bottom:16px;color:#2a64ef;height:22px;width:37%;margin-top:5px;position:relative;top:0;margin-left:15px;background-color:transparent;border:1px solid;opacity:.7;font-size:13px}.mat-form-field-infix[_ngcontent-%COMP%]{padding:0}.qrCodeShowGenerate[_ngcontent-%COMP%]{float:left;display:block;min-width:31px;max-height:70vh;max-width:80vw}removeButton[_ngcontent-%COMP%]{margin-right:10px;margin-top:20px;color:rgba(241,79,49,.6705882352941176);border:1px solid rgba(241,79,49,.5686274509803921)!important}"]}),e})(),A=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Mb({type:e,selectors:[["messages-channel-sidebar-right"]],decls:6,vars:0,consts:[["fullWidth",""],["tabIcon","people-outline",1,"channelParticipantList",2,"overflow-x","hidden","padding-top","12px"],["tabIcon","bell-outline"],["tabIcon","settings-outline",1,"channelSettingsTab"]],template:function(e,t){1&e&&(o.Yb(0,"nb-tabset",0),o.Yb(1,"nb-tab",1),o.Tb(2,"messages-channel-participant-list"),o.Xb(),o.Tb(3,"nb-tab",2),o.Yb(4,"nb-tab",3),o.Tb(5,"messages-channel-settings"),o.Xb(),o.Xb())},directives:[c.H,c.G,M,R],styles:[".channelSettingsTab[_ngcontent-%COMP%]{padding-top:20px}"]}),e})();function K(e,t){if(1&e){const e=o.Zb();o.Yb(0,"button",12),o.fc("click",(function(){return o.xc(e),o.jc(2).lockSideBar("right",!1)})),o.Ic(1,"Lock Panel"),o.Xb()}}function G(e,t){if(1&e){const e=o.Zb();o.Yb(0,"button",12),o.fc("click",(function(){return o.xc(e),o.jc(2).lockSideBar("right",!0)})),o.Ic(1,"Float Panel"),o.Xb()}}function z(e,t){if(1&e){const e=o.Zb();o.Yb(0,"nb-sidebar",9),o.Gc(1,K,2,0,"button",10),o.Gc(2,G,2,0,"button",10),o.Yb(3,"button",11),o.fc("click",(function(){return o.xc(e),o.jc().toggleSideBar("right")})),o.Ic(4,"Hide Panel"),o.Xb(),o.Tb(5,"messages-channel-sidebar-right"),o.Xb()}if(2&e){const e=o.jc();o.pc("fixed",e.sideBarFixed.right),o.Fb(1),o.pc("ngIf",e.sideBarFixed.right),o.Fb(1),o.pc("ngIf",!e.sideBarFixed.right)}}function H(e,t){if(1&e){const e=o.Zb();o.Yb(0,"button",11),o.fc("click",(function(){return o.xc(e),o.jc().lockSideBar("left",!1)})),o.Ic(1,"Lock Panel"),o.Xb()}}function $(e,t){if(1&e){const e=o.Zb();o.Yb(0,"button",11),o.fc("click",(function(){return o.xc(e),o.jc().lockSideBar("left",!0)})),o.Ic(1,"Float Panel"),o.Xb()}}function V(e,t){if(1&e&&o.Tb(0,"messages-channel",6),2&e){const e=t.$implicit,n=o.jc();o.pc("channel",e)("hidden",n.selectedChannel!=e)}}function Z(e,t){if(1&e){const e=o.Zb();o.Yb(0,"div",13),o.fc("click",(function(){return o.xc(e),o.jc().toggleSideBar("left")})),o.Tb(1,"nb-icon",14),o.Xb()}}function W(e,t){if(1&e){const e=o.Zb();o.Yb(0,"div",15),o.fc("click",(function(){return o.xc(e),o.jc().toggleSideBar("right")})),o.Tb(1,"nb-icon",16),o.Xb()}}let Q=(()=>{class e{constructor(e,t,n,i){this.cd=e,this.ui=t,this.sidebarService=n,this.q=i,this.channelNameList=[],this.selectedChannel="NoChannelSelected",this.noChannelSelected="NoChannelSelected",this.sideBarFixed={right:!0,left:!0},this.sideBarVisible={right:!1,left:!0}}ngOnDestroy(){this.sideBarFixedSub.unsubscribe(),this.sideBarVisibleSub.unsubscribe(),this.channelFolderListSub.unsubscribe(),this.selectedChannelSub.unsubscribe()}ngOnInit(){return Object(s.a)(this,void 0,void 0,(function*(){for(;!this.q.isReady()||!this.q.os.isSignedIn();)yield this.ui.delay(1e3);this.sideBarFixed=this.q.os.bee.config.getSideBarFixed(),this.sideBarVisible=this.q.os.bee.config.getSideBarVisible(),console.log("toggling:",this.sideBarVisible),this.sideBarVisible.left?this.sideBarVisible.left&&this.sidebarService.expand("left"):this.sidebarService.collapse("left"),this.sideBarVisible.right||this.sidebarService.collapse("right"),this.sideBarVisible.right&&this.sidebarService.expand("right"),this.sideBarFixedSub=this.q.os.bee.config.sideBarFixedSub.subscribe(e=>{this.sideBarFixed=this.q.os.bee.config.getSideBarFixed()}),this.sideBarVisibleSub=this.q.os.bee.config.sideBarVisibleSub.subscribe(e=>{console.log("getting",e),this.sideBarVisible=this.q.os.bee.config.getSideBarVisible(),this.sideBarVisible.left?this.sideBarVisible.left&&this.sidebarService.expand("left"):this.sidebarService.collapse("left"),this.sideBarVisible.right||this.sidebarService.collapse("right"),this.sideBarVisible.right&&this.sidebarService.expand("right")}),setTimeout(()=>{this.sideBarFixed=this.q.os.bee.config.getSideBarFixed(),this.sideBarVisible=this.q.os.bee.config.getSideBarVisible(),console.log("toggling:",this.sideBarVisible),this.sideBarVisible.left?this.sideBarVisible.left&&this.sidebarService.expand("left"):this.sidebarService.collapse("left"),this.sideBarVisible.right||this.sidebarService.collapse("right"),this.sideBarVisible.right&&this.sidebarService.expand("right"),this.channelNameList=this.q.os.ocean.dolphin.getChannelNameList(),this.selectedChannel=this.q.os.channel.getSelected()},100),this.channelFolderListSub=this.q.os.bee.config.channelFolderListSub.subscribe(e=>{this.channelNameList=this.q.os.ocean.dolphin.getChannelNameList()}),this.selectedChannelSub=this.q.os.channel.onSelect().subscribe(e=>{this.selectedChannel=e,console.log("Channel-Tab: Selected Channel: >>"+this.selectedChannel+"<<"),console.log("Channel-Tab: noChannelSelected: >>"+this.noChannelSelected+"<<"),this.cd.detectChanges()})}))}lockSideBar(e,t){this.sideBarFixed[e]=t,this.q.os.bee.config.setSideBarFixed(this.sideBarFixed),this.q.os.bee.config.commitNow()}toggleSideBar(e){this.sideBarVisible=this.q.os.bee.config.getSideBarVisible(),this.sideBarVisible[e]=1!=this.sideBarVisible[e],this.q.os.bee.config.setSideBarVisible(this.sideBarVisible),this.q.os.bee.config.commitNow()}}return e.\u0275fac=function(t){return new(t||e)(o.Sb(o.h),o.Sb(a.a),o.Sb(c.D),o.Sb(r.a))},e.\u0275cmp=o.Mb({type:e,selectors:[["messages-channel-tab"]],decls:13,vars:9,consts:[[1,"channelScreen"],["state","expanded","right","","tag","right","class","rightSideBar","collapsed","true",3,"fixed",4,"ngIf"],["state","expanded","left","","tag","left",1,"leftSideBar",3,"fixed"],["mat-stroked-button","","color","primary",1,"defaultSettingsButton","thinOutlineButton",2,"margin-right","24px","margin-left","0px",3,"click"],["mat-stroked-button","","color","primary","class","defaultSettingsButton thinOutlineButton",3,"click",4,"ngIf"],["class","channel",3,"channel","hidden",4,"ngFor","ngForOf"],[1,"channel",3,"channel","hidden"],["class","toggleSideBarRight toggleSideBarLeft","class","toggleSideBarLeft",3,"click",4,"ngIf"],["class","toggleSideBarRight","class","toggleSideBarRight",3,"click",4,"ngIf"],["state","expanded","right","","tag","right","collapsed","true",1,"rightSideBar",3,"fixed"],["mat-stroked-button","","color","primary","class","defaultSettingsButton thinOutlineButton","style","margin-left: 3px;margin-right: 21px;",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",1,"defaultSettingsButton","thinOutlineButton",3,"click"],["mat-stroked-button","","color","primary",1,"defaultSettingsButton","thinOutlineButton",2,"margin-left","3px","margin-right","21px",3,"click"],[1,"toggleSideBarLeft",3,"click"],["icon","list-outline"],[1,"toggleSideBarRight",3,"click"],["icon","more-vertical-outline"]],template:function(e,t){1&e&&(o.Yb(0,"nb-layout",0),o.Gc(1,z,6,3,"nb-sidebar",1),o.Yb(2,"nb-sidebar",2),o.Yb(3,"button",3),o.fc("click",(function(){return t.toggleSideBar("left")})),o.Ic(4,"Hide Panel"),o.Xb(),o.Gc(5,H,2,0,"button",4),o.Gc(6,$,2,0,"button",4),o.Tb(7,"messages-channel-sidebar-left"),o.Xb(),o.Yb(8,"nb-layout-column"),o.Gc(9,V,1,2,"messages-channel",5),o.Tb(10,"messages-channel",6),o.Xb(),o.Xb(),o.Gc(11,Z,2,0,"div",7),o.Gc(12,W,2,0,"div",8)),2&e&&(o.Fb(1),o.pc("ngIf","NoChannelSelected"!=t.selectedChannel),o.Fb(1),o.pc("fixed",t.sideBarFixed.left),o.Fb(3),o.pc("ngIf",t.sideBarFixed.left),o.Fb(1),o.pc("ngIf",!t.sideBarFixed.left),o.Fb(3),o.pc("ngForOf",t.channelNameList),o.Fb(1),o.pc("channel",t.noChannelSelected)("hidden",t.selectedChannel!=t.noChannelSelected),o.Fb(1),o.pc("ngIf",!t.sideBarVisible.left),o.Fb(1),o.pc("ngIf",!t.sideBarVisible.right&&"NoChannelSelected"!=t.selectedChannel))},directives:[c.u,l.m,c.B,d.a,u,c.t,l.l,p.a,A,c.o],styles:[".toggleSideBarRight[_ngcontent-%COMP%]{right:7px}.toggleSideBarLeft[_ngcontent-%COMP%], .toggleSideBarRight[_ngcontent-%COMP%]{z-index:20;position:fixed;top:66px;cursor:pointer;color:#36f!important}.toggleSideBarLeft[_ngcontent-%COMP%]{left:7px}.defaultSettingsButton[_ngcontent-%COMP%]{padding-left:10px;padding-right:10px}.leftSideBar[_ngcontent-%COMP%]{z-index:52}.rightSideBar[_ngcontent-%COMP%]{z-index:51}"]}),e})(),J=(()=>{class e{constructor(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Mb({type:e,selectors:[["quest-messenger-root"]],decls:1,vars:0,template:function(e,t){1&e&&o.Tb(0,"messages-channel-tab")},directives:[Q],styles:[".centerButtonWrapper[_ngcontent-%COMP%]{position:fixed;bottom:3vh;left:0;right:0}.centerButtonContainer[_ngcontent-%COMP%]{margin:auto}.statusBarWrapper[_ngcontent-%COMP%]{position:fixed;bottom:0;max-height:28px;height:28px;left:0;right:0;background-color:#2d2a2a;z-index:20;font-size:14px;color:grey;padding-left:10px;padding-right:10px;border-top:1px solid #000}.statusBarRouterIcon[_ngcontent-%COMP%]{top:4px;margin:0;position:relative;line-height:10px;font-size:21px}.statusBarRadioIcon[_ngcontent-%COMP%]{top:-5px;margin:0 0 0 5px;position:relative;line-height:9px;font-size:17px}.web-top-links[_ngcontent-%COMP%]{position:fixed;right:13px;cursor:pointer;z-index:20;top:14px}@media only screen and (max-width:500px){.web-top-links[_ngcontent-%COMP%]{display:none}}"]}),e})();const U=[{path:"",component:J}];let ee=(()=>{class e{}return e.\u0275mod=o.Qb({type:e}),e.\u0275inj=o.Pb({factory:function(t){return new(t||e)},imports:[[i.g.forChild(U)],i.g]}),e})();var te=n("5RNC"),ne=n("Wp6s"),ie=n("bSwM"),oe=n("STbY"),se=n("8yBR"),ae=n("YUcS"),ce=n("6NWb"),re=n("IyRd"),le=n("f6nW"),de=n("FvrZ"),he=n("tk/3");let ge=(()=>{class e{}return e.\u0275mod=o.Qb({type:e}),e.\u0275inj=o.Pb({factory:function(t){return new(t||e)},imports:[l.c,v.f,i.g]}),e})();n("9gUW"),n("xUDc"),n("8SwR"),n("waa1"),n("bzWg"),n("cVQz"),n("K9Od");var ue=n("tayM"),pe=n("zwFz"),be=n("d3J+"),fe=n("fP41");let me=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[{provide:ue.a,useValue:t||{}}]}}static forChild(t){return{ngModule:e,providers:[{provide:ue.a,useValue:t||{}}]}}}return e.\u0275mod=o.Qb({type:e}),e.\u0275inj=o.Pb({factory:function(t){return new(t||e)},imports:[[ge,c.q,c.s,c.b,pe.b,be.b,c.n,fe.a]]}),e})();var ve=n("NFeN"),Ce=n("tR1z");let Fe=(()=>{class e{}return e.\u0275mod=o.Qb({type:e,bootstrap:[J]}),e.\u0275inj=o.Pb({factory:function(t){return new(t||e)},providers:[c.l],imports:[[c.C,le.p,de.d,c.x,T.b,he.b,ne.a,j.b,d.b,ie.a,oe.c,l.c,ee,ce.a,c.J,c.v,me,c.I,Ce.a,c.q,v.f,c.j,c.k.forRoot(),c.g,se.d,b.c,d.b,ie.a,m.b,Y.d,re.b,te.a,ae.a,ve.b,fe.a],le.p,Y.d,j.b,se.d,oe.c]}),e})()},"8SwR":function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n("fXoL"),o=n("jhN1"),s=n("ofXK"),a=n("aceb"),c=n("3Pt+"),r=n("zwFz"),l=n("d3J+");function d(e,t){if(1&e){const e=i.Zb();i.Yb(0,"div"),i.Yb(1,"span",13),i.fc("click",(function(){i.xc(e);const t=i.jc().$implicit;return i.jc(2).removeFile(t)})),i.Ic(2,"\xd7"),i.Xb(),i.Xb()}if(2&e){const e=i.jc().$implicit;i.Dc("background-image",e.urlStyle)}}function h(e,t){1&e&&i.Tb(0,"nb-icon",14)}function g(e,t){if(1&e){const e=i.Zb();i.Wb(0),i.Gc(1,d,3,2,"div",11),i.Yb(2,"div"),i.Gc(3,h,1,0,"nb-icon",12),i.Yb(4,"span",13),i.fc("click",(function(){i.xc(e);const n=t.$implicit;return i.jc(2).removeFile(n)})),i.Ic(5,"\xd7"),i.Xb(),i.Xb(),i.Vb()}if(2&e){const e=t.$implicit;i.Fb(1),i.pc("ngIf",e.urlStyle),i.Fb(2),i.pc("ngIf",!e.urlStyle)}}function u(e,t){if(1&e&&(i.Yb(0,"div",9),i.Gc(1,g,6,2,"ng-container",10),i.Xb()),2&e){const e=i.jc();i.Fb(1),i.pc("ngForOf",e.droppedFiles)}}function p(e,t){if(1&e&&i.Tb(0,"nb-icon",15),2&e){const e=i.jc();i.pc("icon",e.buttonIcon)}}function b(e,t){if(1&e&&i.Ic(0),2&e){const e=i.jc();i.Jc(e.buttonTitle)}}function f(e,t){if(1&e){const e=i.Zb();i.Yb(0,"emoji-mart",16),i.fc("emojiClick",(function(t){return i.xc(e),i.jc().addEmoji(t)})),i.Xb()}}let m=(()=>{class e{constructor(e,t){this.cd=e,this.domSanitizer=t,this.newMessage="",this.emojiPickerActive=!1,this.status="",this.inputFocus=!1,this.inputHover=!1,this.droppedFiles=[],this.imgDropTypes=["image/png","image/jpeg","image/gif"],this.message="",this.buttonTitle="",this.buttonIcon="paper-plane-outline",this.showButton=!0,this.dropFiles=!1,this.send=new i.p,this.fileOver=!1}addEmoji(e){this.newMessage+=" "+e.emoji.colons+" ",this.emojiPickerActive=!1}openEmojiPicker(){this.emojiPickerActive=!0}onDrop(e){if(this.dropFiles&&(e.preventDefault(),e.stopPropagation(),this.fileOver=!1,e.dataTransfer&&e.dataTransfer.files))for(const t of e.dataTransfer.files){const e=t;if(this.imgDropTypes.includes(t.type)){const n=new FileReader;n.onload=t=>{e.src=t.target.result,e.urlStyle=this.domSanitizer.bypassSecurityTrustStyle(`url(${e.src})`),this.cd.detectChanges()},n.readAsDataURL(t)}this.droppedFiles.push(e)}}removeFile(e){const t=this.droppedFiles.indexOf(e);t>=0&&this.droppedFiles.splice(t,1)}onDragOver(){this.dropFiles&&(this.fileOver=!0)}onDragLeave(){this.dropFiles&&(this.fileOver=!1)}sendMessage(){(this.droppedFiles.length||String(this.newMessage).trim().length)&&(this.send.emit({message:this.newMessage,files:this.droppedFiles}),this.message="",this.newMessage="",this.droppedFiles=[])}setStatus(e){this.status!==e&&(this.status=e,this.cd.detectChanges())}getInputStatus(){return this.fileOver?this.status||"primary":this.inputFocus||this.inputHover?this.status:""}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(i.h),i.Sb(o.b))},e.\u0275cmp=i.Mb({type:e,selectors:[["nb-chat-form"]],hostVars:2,hostBindings:function(e,t){1&e&&i.fc("drop",(function(e){return t.onDrop(e)}))("dragover",(function(){return t.onDragOver()}))("dragleave",(function(){return t.onDragLeave()})),2&e&&i.Kb("file-over",t.fileOver)},inputs:{message:"message",buttonTitle:"buttonTitle",buttonIcon:"buttonIcon",showButton:"showButton",dropFiles:"dropFiles"},outputs:{send:"send"},decls:10,vars:11,consts:[["class","dropped-files",4,"ngIf"],[1,"message-row"],[2,"width","100%"],["nbInput","","fullWidth","","type","text",3,"ngModel","status","placeholder","ngModelChange","focus","blur","mouseenter","mouseleave","keyup.enter"],["nbSuffix","","nbButton","","ghost","",3,"status","click"],["pack","nebular-essentials",3,"icon",4,"ngIf","ngIfElse"],["title",""],["title","Pick your emoji\u2026","emoji","blush","class","emojiPicker","darkMode","true","style","position: absolute;  bottom: 30px;  right: 80px;",3,"emojiClick",4,"ngIf"],["emoji","grinning","set","apple","size","26",1,"emojiPickerTrigger",3,"click"],[1,"dropped-files"],[4,"ngFor","ngForOf"],[3,"background-image",4,"ngIf"],["icon","file-text-outline","pack","nebular-essentials",4,"ngIf"],[1,"remove",3,"click"],["icon","file-text-outline","pack","nebular-essentials"],["pack","nebular-essentials",3,"icon"],["title","Pick your emoji\u2026","emoji","blush","darkMode","true",1,"emojiPicker",2,"position","absolute","bottom","30px","right","80px",3,"emojiClick"]],template:function(e,t){if(1&e&&(i.Gc(0,u,2,1,"div",0),i.Yb(1,"div",1),i.Yb(2,"nb-form-field",2),i.Yb(3,"input",3),i.fc("ngModelChange",(function(e){return t.newMessage=e}))("focus",(function(){return t.inputFocus=!0}))("blur",(function(){return t.inputFocus=!1}))("mouseenter",(function(){return t.inputHover=!0}))("mouseleave",(function(){return t.inputHover=!1}))("ngModelChange",(function(e){return t.message=e}))("keyup.enter",(function(){return t.sendMessage()})),i.Xb(),i.Yb(4,"button",4),i.fc("click",(function(){return t.sendMessage()})),i.Gc(5,p,1,1,"nb-icon",5),i.Gc(6,b,1,1,"ng-template",null,6,i.Hc),i.Xb(),i.Xb(),i.Xb(),i.Gc(8,f,1,0,"emoji-mart",7),i.Yb(9,"ngx-emoji",8),i.fc("click",(function(){return t.openEmojiPicker()})),i.Xb()),2&e){const e=i.vc(7);i.pc("ngIf",null==t.droppedFiles?null:t.droppedFiles.length),i.Fb(3),i.Kb("with-button",t.showButton),i.qc("placeholder",t.fileOver?"Drop file to send":"Type a message"),i.pc("ngModel",t.newMessage)("status",t.getInputStatus())("ngModel",t.message),i.Fb(1),i.pc("status",t.status||"primary"),i.Fb(1),i.pc("ngIf",!t.buttonTitle)("ngIfElse",e),i.Fb(3),i.pc("ngIf",t.emojiPickerActive)}},directives:[s.m,a.m,a.r,c.b,c.j,c.m,a.a,a.E,r.a,s.l,a.o,l.a],styles:[""],changeDetection:0}),e})()},"9gUW":function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n("8SwR"),o=n("xUDc"),s=n("fXoL"),a=n("ofXK");const c=["scrollable"];function r(e,t){1&e&&(s.Yb(0,"p",6),s.Ic(1,"No messages yet."),s.Xb())}const l=[[["nb-chat-message"]],[["nb-chat-form"]]],d=["nb-chat-message","nb-chat-form"];let h=(()=>{class e{constructor(){this._scrollBottom=!0}get scrollBottom(){return this._scrollBottom}set scrollBottom(e){var t;this._scrollBottom="string"==typeof(t=e)?"true"===(t=t.toLowerCase().trim())||""===t:!!t}ngOnChanges(e){"status"in e&&this.updateFormStatus()}ngAfterContentInit(){this.updateFormStatus()}ngAfterViewInit(){this.messages.changes.subscribe(e=>{this.messages=e,this.updateView()}),window["quest-network-ui-globals"]={},window["quest-network-ui-globals"]["messages-chat-scrollable"]=this.scrollable.nativeElement,this.updateView()}updateView(){this.scrollBottom&&this.scrollListBottom()}scrollListBottom(){window["quest-network-ui-globals"]={},window["quest-network-ui-globals"]["messages-chat-scrollable"]=this.scrollable.nativeElement,this.scrollable.nativeElement.scrollTop>this.scrollable.nativeElement.scrollHeight-$(this.scrollable.nativeElement).height()-210&&(this.scrollable.nativeElement.scrollTop=this.scrollable.nativeElement.scrollHeight)}updateFormStatus(){this.chatForm&&this.chatForm.setStatus(this.status)}get tiny(){return"tiny"===this.size}get small(){return"small"===this.size}get medium(){return"medium"===this.size}get large(){return"large"===this.size}get giant(){return"giant"===this.size}get primary(){return"primary"===this.status}get success(){return"success"===this.status}get info(){return"info"===this.status}get warning(){return"warning"===this.status}get danger(){return"danger"===this.status}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Mb({type:e,selectors:[["nb-chat"]],contentQueries:function(e,t,n){var a;1&e&&(s.Lb(n,i.a,!0),s.Lb(n,o.a,!1)),2&e&&(s.uc(a=s.gc())&&(t.chatForm=a.first),s.uc(a=s.gc())&&(t.messages=a))},viewQuery:function(e,t){var n;1&e&&s.Mc(c,!0),2&e&&s.uc(n=s.gc())&&(t.scrollable=n.first)},hostVars:20,hostBindings:function(e,t){2&e&&s.Kb("size-tiny",t.tiny)("size-small",t.small)("size-medium",t.medium)("size-large",t.large)("size-giant",t.giant)("status-primary",t.primary)("status-success",t.success)("status-info",t.info)("status-warning",t.warning)("status-danger",t.danger)},inputs:{title:"title",size:"size",status:"status",scrollBottom:"scrollBottom"},features:[s.Db],ngContentSelectors:d,decls:9,vars:2,consts:[[1,"header"],["id","scrollableChatContainer",1,"scrollable"],["scrollable",""],[1,"messages"],["class","no-messages",4,"ngIf"],[1,"form"],[1,"no-messages"]],template:function(e,t){1&e&&(s.oc(l),s.Yb(0,"div",0),s.Ic(1),s.Xb(),s.Yb(2,"div",1,2),s.Yb(4,"div",3),s.nc(5),s.Gc(6,r,2,0,"p",4),s.Xb(),s.Xb(),s.Yb(7,"div",5),s.nc(8,1),s.Xb()),2&e&&(s.Fb(1),s.Jc(t.title),s.Fb(5),s.pc("ngIf",!(null!=t.messages&&t.messages.length)))},directives:[a.m],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;position:relative;height:100%}.messages[_ngcontent-%COMP%]{padding-bottom:0!important;margin-bottom:0}"]}),e})()},Cjz3:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return F}));var i=n("n2fA"),o=n("dT8p"),s=n("fXoL"),a=n("jhN1"),c=n("Witw"),r=n("gvxT"),l=n("XiUz"),d=n("3Pt+"),h=n("kmnG"),g=n("qFsG"),u=n("bTqV"),p=n("9gUW"),b=n("ofXK"),f=n("8SwR"),m=n("xUDc");const v=["newMessage"];function C(e,t){if(1&e&&s.Tb(0,"nb-chat-message",17),2&e){const e=t.$implicit;s.pc("type",e.type)("message",e.message)("reply",e.reply)("sender",e.participant)("date",e.timestamp)("files",e.files)("quote",e.quote)("latitude",e.latitude)("longitude",e.longitude)("avatar",e.participant.avatar)}}let F=(()=>{class t{constructor(e,t,n,i){this._sanitizer=e,this.aChD=t,this.ui=n,this.q=i,this.DEVMODE=o.dev,this.noChannelSelected="NoChannelSelected",this.channelDisplayName="NoChannelSelected",this.showChallengeScreen=!1,this.showJoinScreen=!1,this.showInviteScreen=!1,this.messages=[],this.handledMessages=[]}ngOnDestroy(){void 0!==this.channelSub&&this.channelSub.unsubscribe()}scrollBottom(){try{this.scrollable={},this.scrollable.nativeElement=window["quest-network-ui-globals"]["messages-chat-scrollable"],null!=this.scrollable.nativeElement&&this.scrollable.nativeElement.scrollTop>this.scrollable.nativeElement.scrollHeight-$(this.scrollable.nativeElement).height()-210&&(this.scrollable.nativeElement.scrollTop=this.scrollable.nativeElement.scrollHeight)}catch(e){console.log(e)}}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){console.log("Channel: Initializing..."),console.log("Channel: Bootstrapping Channel..."),"NoChannelSelected"!=this.channel&&(setTimeout(()=>{this.scrollBottom()},2500),yield this.attemptJoinChannel(this.channel)),this.channelDisplayName=yield this.getChannelDisplayName(this.channel)}))}getChannelDisplayName(e){return Object(i.a)(this,void 0,void 0,(function*(){return e.indexOf("qprivatedch")>-1?yield this.q.os.social.getAliasFromDirectChannel2(e):e}))}goToCaptcha(){this.showChallengeScreen=!0,this.showJoinScreen=!1,this.showInviteScreen=!1}goToInviteScreen(){this.showChallengeScreen=!1,this.showJoinScreen=!1,this.showInviteScreen=!0}goToJoin(){this.showChallengeScreen=!1,this.showJoinScreen=!0,this.showInviteScreen=!1}challengeFail(){return this.showChallengeScreen=!0,this.ui.updateProcessingStatus(!1),this.ui.setElectronSize("0-keyimport"),this.ui.showSnack("Prove that you are smart","Please",{duration:4e3}),!1}completedChallenge(e){setTimeout(()=>{this.ui.updateProcessingStatus(!1)},3e4),this.ui.updateProcessingStatus(!0),this.q.os.ocean.dolphin.completedChallenge(this.channel,e)}capitalize(e){return"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)}handleNewMessage(t){return Object(i.a)(this,void 0,void 0,(function*(){if("CHALLENGE"==t.type){if(console.log("Received Challenge"),void 0!==t.captchaImageBuffer){let n=e.from(t.captchaImageBuffer.data).toString("base64");this.captchaImageResource=this._sanitizer.bypassSecurityTrustUrl("data:image/png;base64,"+n)}this.showJoinScreen=!0,this.ui.updateProcessingStatus(!1),this.aChD.detectChanges()}else if("ownerSayHi"==t.type)this.ui.updateProcessingStatus(!1),this.showChallengeScreen=!1,this.showJoinScreen=!1,this.showInviteScreen=!1,this.aChD.detectChanges();else if("CHANNEL_MESSAGE"==t.type){t.participant={},t.reply=!!t.self;let e=yield this.getSocialProfileForChannelPubKey(t.channel,t.channelPubKey);if(t.participant.name=void 0!==e.nick?e.nick:e.alias,void 0!==e.key?(t.participant.social=e.key.pubKey,t.participant.isFavorite=this.q.os.social.profile.isFavorite(e.key.pubKey),t.participant.isRequestedFavorite=this.q.os.social.profile.isRequestedFavorite(e.key.pubKey)):(t.participant.social="unknown",t.participant.isFavorite=!1,t.participant.isRequestedFavorite=!1),t.participant.avatar="./assets/defaultAvatar.png",console.log(this.q.os.ui.getHandledMessages()),this.messages.length>0&&t.channelPubKey==this.messages[this.messages.length-1].channelPubKey&&!this.q.os.utilities.inArray(this.q.os.ui.getHandledMessages(),t.id)){let e="\n";try{let t=this.messages[this.messages.length-1].message,n=String(t).split("\n");n.length>1&&(t=String(n[n.length-1]),"!"==t.trim().charAt(t.length-1)||"?"==t.trim().charAt(t.length-1)||","==t.trim().charAt(t.length-1)||"."==t.trim().charAt(t.length-1)||";"==t.trim().charAt(t.length-1)?e=" ":":"!=t.trim().charAt(t.length-1)&&"-"!=t.trim().charAt(t.length-1)&&":"!=t.trim().charAt(t.length-1)&&(e="\n"))}catch(n){console.log(n)}this.q.os.ui.addHandledMessage(t.id),this.messages[this.messages.length-1].message+=e+this.capitalize(String(t.message).trim())}else this.q.os.utilities.inArray(this.q.os.ui.getHandledMessages(),t.id)||(t.message=this.capitalize(String(t.message).trim()),this.messages.push(t));this.aChD.detectChanges()}return!0}))}getSocialProfileForChannelPubKey(e,t){return Object(i.a)(this,void 0,void 0,(function*(){let n,i=this.q.os.channel.getParticipantFolders(e);if(i.length>0)for(let e=0;e<i.length;e++)for(let n=0;n<i[e].participants.length;n++){if(i[e].participants[n].pubKey==t&&void 0!==i[e].participants[n].nick&&""!=i[e].participants[n].nick){let t;try{t=yield this.q.os.social.profile.getByChannelPubKey(i[e].participants[n].pubKey)}catch(o){console.log(o)}return void 0!==t&&void 0!==t.alias?(t.nick=i[e].participants[n].nick,t):{nick:i[e].participants[n].nick}}if(i[e].participants[n].pubKey==t){let t;try{t=yield this.q.os.social.profile.getByChannelPubKey(i[e].participants[n].pubKey)}catch(o){console.log(o)}if(void 0!==t&&void 0!==t.alias)return t}}try{n=yield this.q.os.social.profile.getByChannelPubKey(t)}catch(o){console.log(o)}return void 0!==n&&void 0!==n.alias?n:{alias:"Anonymous"}}))}attemptJoinChannel(e){return Object(i.a)(this,void 0,void 0,(function*(){this.q.os.sendBootMessage("Shaking Hands..."),setTimeout(()=>{this.ui.updateProcessingStatus(!1)},2e4),console.log("attempting to join: ",e);try{this.q.os.ocean.dolphin.isSubscribed(this.channel)||(yield this.q.os.ocean.dolphin.joinChannel(e));let t=this.q.os.ocean.dolphin.getChannelHistory(this.channel);this.DEVMODE&&console.log("got history: ",t);for(let e=0;e<t.length;e++)yield this.handleNewMessage(t[e]);this.channelSub=this.q.os.ocean.dolphin.listen(e).subscribe(e=>Object(i.a)(this,void 0,void 0,(function*(){yield this.handleNewMessage(e)})));let n=this.q.os.ocean.dolphin.isOwner(e,this.q.os.ocean.dolphin.getChannelKeyChain(e).channelPubKey);console.log("isOwner:",n),n&&(this.showChallengeScreen=!1,this.showJoinScreen=!1,this.showInviteScreen=!1,this.ui.updateProcessingStatus(!1))}catch(t){return"reCaptcha"==t?this.challengeFail():"key invalid"==t?(this.ui.showSnack("Invalid Key!","Start Over",{duration:8e3}),this.ui.delay(2e3),!1):(this.ui.showSnack("Swarm Error =(","Start Over",{duration:8e3}),console.log(t),yield this.ui.delay(5e3),!1)}}))}publishChannelMessage(e){return Object(i.a)(this,void 0,void 0,(function*(){this.q.os.channel.publish(this.channel,e.message),this.newMessage.nativeElement.value=""}))}}return t.\u0275fac=function(e){return new(e||t)(s.Sb(a.b),s.Sb(s.h),s.Sb(c.a),s.Sb(r.a))},t.\u0275cmp=s.Mb({type:t,selectors:[["messages-channel"]],viewQuery:function(e,t){var n;1&e&&s.Mc(v,!0),2&e&&s.uc(n=s.gc())&&(t.newMessage=n.first)},inputs:{channel:"channel"},decls:41,vars:10,consts:[[1,"captchaScreen",3,"hidden"],["fxLayout","column","fxLayoutAlign","space-around center"],[1,"wrapper"],[1,"frameThumbnail",2,"width","80%","margin","10%","margin-top","0",3,"src"],[1,"example-form"],[1,"example-full-width"],["matInput","","placeholder","Captcha Text","value","","name","captchaCode",3,"ngModel","ngModelChange"],["mat-stroked-button","","color","primary",1,"thickOutlineButton","marginRight20",3,"click"],["mat-stroked-button","","color","primary",1,"thickOutlineButton",3,"click"],[1,"inviteScreen",3,"hidden"],["color","primary",1,"example-full-width"],["matInput","","placeholder","Invite Code","value","","name","inviteToken",3,"ngModel","ngModelChange"],[1,"joinScreen",3,"hidden"],[1,"chatScreen",3,"hidden"],[3,"title"],[3,"type","message","reply","sender","date","files","quote","latitude","longitude","avatar",4,"ngFor","ngForOf"],[3,"dropFiles","send"],[3,"type","message","reply","sender","date","files","quote","latitude","longitude","avatar"]],template:function(e,t){1&e&&(s.Yb(0,"div",0),s.Yb(1,"div",1),s.Yb(2,"div",2),s.Tb(3,"img",3),s.Yb(4,"form",4),s.Yb(5,"mat-form-field",5),s.Yb(6,"mat-label"),s.Ic(7,"Captcha Text"),s.Xb(),s.Yb(8,"input",6),s.fc("ngModelChange",(function(e){return t.captchaCode=e})),s.Xb(),s.Xb(),s.Xb(),s.Yb(9,"button",7),s.fc("click",(function(){return t.goToJoin()})),s.Ic(10,"Back"),s.Xb(),s.Yb(11,"button",8),s.fc("click",(function(){return t.completedChallenge(t.captchaCode)})),s.Ic(12,"I Aced That IQ Test"),s.Xb(),s.Xb(),s.Xb(),s.Xb(),s.Yb(13,"div",9),s.Yb(14,"div",1),s.Yb(15,"div",2),s.Ic(16," Enter Invite code: "),s.Yb(17,"form",4),s.Yb(18,"mat-form-field",10),s.Yb(19,"mat-label"),s.Ic(20,"Invite Code"),s.Xb(),s.Yb(21,"input",11),s.fc("ngModelChange",(function(e){return t.inviteToken=e})),s.Xb(),s.Xb(),s.Xb(),s.Tb(22,"br"),s.Tb(23,"br"),s.Yb(24,"button",7),s.fc("click",(function(){return t.goToJoin()})),s.Ic(25,"Back"),s.Xb(),s.Yb(26,"button",8),s.fc("click",(function(){return t.completedChallenge(t.inviteToken)})),s.Ic(27,"Let me in!"),s.Xb(),s.Xb(),s.Xb(),s.Xb(),s.Yb(28,"div",12),s.Yb(29,"div",1),s.Yb(30,"div",2),s.Yb(31,"button",8),s.fc("click",(function(){return t.goToInviteScreen()})),s.Ic(32,"I have an invite code!"),s.Xb(),s.Tb(33,"br"),s.Tb(34,"br"),s.Yb(35,"button",8),s.fc("click",(function(){return t.goToCaptcha()})),s.Ic(36,"Give me the challenge!"),s.Xb(),s.Xb(),s.Xb(),s.Xb(),s.Yb(37,"div",13),s.Yb(38,"nb-chat",14),s.Gc(39,C,1,10,"nb-chat-message",15),s.Yb(40,"nb-chat-form",16),s.fc("send",(function(e){return t.publishChannelMessage(e)})),s.Xb(),s.Xb(),s.Xb()),2&e&&(s.pc("hidden",!t.showChallengeScreen),s.Fb(3),s.pc("src",t.captchaImageResource,s.zc),s.Fb(5),s.pc("ngModel",t.captchaCode),s.Fb(5),s.pc("hidden",!t.showInviteScreen),s.Fb(8),s.pc("ngModel",t.inviteToken),s.Fb(7),s.pc("hidden",!t.showJoinScreen),s.Fb(9),s.pc("hidden",t.showJoinScreen||t.showInviteScreen||t.showChallengeScreen||t.channel==t.noChannelSelected),s.Fb(1),s.qc("title",t.channelDisplayName),s.Fb(1),s.pc("ngForOf",t.messages),s.Fb(1),s.pc("dropFiles",!0))},directives:[l.b,l.a,d.p,d.k,d.l,h.b,h.f,g.a,d.b,d.j,d.m,u.a,p.a,b.l,f.a,m.a],styles:[".browse-files-button[_ngcontent-%COMP%]{border-radius:3px;padding:5px;color:purple}.importButton[_ngcontent-%COMP%]{color:purple!important}.captchaScreen[_ngcontent-%COMP%], .inviteScreen[_ngcontent-%COMP%], .joinScreen[_ngcontent-%COMP%]{background-color:#222b45;padding:20px;text-align:center}.captchaScreen[_ngcontent-%COMP%], .captchaScreen[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .chatScreen[_ngcontent-%COMP%], .inviteScreen[_ngcontent-%COMP%], .inviteScreen[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .joinScreen[_ngcontent-%COMP%], .joinScreen[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:100%}"]}),t})()}).call(this,n("tjlA").Buffer)},K9Od:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("fXoL"),o=n("tayM"),s=n("bzWg");const a=function(e){return[e]};let c=(()=>{class e{constructor(e){this.mapKey=e.messageGoogleMapKey}get file(){return{url:`https://maps.googleapis.com/maps/api/staticmap?center=${this.latitude},${this.longitude}&zoom=12&size=400x400&key=${this.mapKey}`,type:"image/png",icon:"location"}}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(o.a))},e.\u0275cmp=i.Mb({type:e,selectors:[["nb-chat-message-map"]],inputs:{message:"message",sender:"sender",date:"date",latitude:"latitude",longitude:"longitude"},decls:1,vars:6,consts:[[3,"files","message","sender","date"]],template:function(e,t){1&e&&i.Tb(0,"nb-chat-message-file",0),2&e&&i.pc("files",i.sc(4,a,t.file))("message",t.message)("sender",t.sender)("date",t.date)},directives:[s.a],encapsulation:2,changeDetection:0}),e})()},bzWg:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n("fXoL"),o=n("jhN1"),s=n("waa1"),a=n("ofXK"),c=n("aceb");function r(e,t){if(1&e&&i.Tb(0,"nb-icon",7),2&e){const e=i.jc().$implicit;i.pc("icon",e.icon)}}function l(e,t){if(1&e&&i.Tb(0,"div"),2&e){const e=i.jc().$implicit;i.Dc("background-image",e.urlStyle)}}function d(e,t){if(1&e&&(i.Yb(0,"a",4),i.Gc(1,r,1,1,"nb-icon",5),i.Gc(2,l,1,2,"div",6),i.Xb()),2&e){const e=t.$implicit;i.pc("href",e.url,i.zc),i.Fb(1),i.pc("ngIf",!e.urlStyle&&e.icon),i.Fb(1),i.pc("ngIf",e.urlStyle)}}function h(e,t){if(1&e&&(i.Wb(0),i.Yb(1,"div",2),i.Gc(2,d,3,3,"a",3),i.Xb(),i.Vb()),2&e){const e=i.jc();i.Fb(2),i.pc("ngForOf",e.readyFiles)}}function g(e,t){if(1&e&&i.Tb(0,"nb-icon",7),2&e){const e=i.jc(2);i.pc("icon",e.readyFiles[0].icon)}}function u(e,t){if(1&e&&i.Tb(0,"div"),2&e){const e=i.jc(2);i.Dc("background-image",e.readyFiles[0].urlStyle)}}function p(e,t){if(1&e&&(i.Wb(0),i.Yb(1,"a",4),i.Gc(2,g,1,1,"nb-icon",5),i.Gc(3,u,1,2,"div",6),i.Xb(),i.Vb()),2&e){const e=i.jc();i.Fb(1),i.pc("href",e.readyFiles[0].url,i.zc),i.Fb(1),i.pc("ngIf",!e.readyFiles[0].urlStyle&&e.readyFiles[0].icon),i.Fb(1),i.pc("ngIf",e.readyFiles[0].urlStyle)}}let b=(()=>{class e{constructor(e,t){this.cd=e,this.domSanitizer=t}set files(e){this.readyFiles=(e||[]).map(e=>{const t=this.isImage(e);return Object.assign(Object.assign({},e),{urlStyle:t&&this.domSanitizer.bypassSecurityTrustStyle(`url(${e.url})`),isImage:t})}),this.cd.detectChanges()}isImage(e){return["image/png","image/jpeg","image/gif"].includes(e.type)}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(i.h),i.Sb(o.b))},e.\u0275cmp=i.Mb({type:e,selectors:[["nb-chat-message-file"]],inputs:{message:"message",sender:"sender",date:"date",files:"files"},decls:4,vars:6,consts:[[3,"sender","date","message"],[4,"ngIf"],[1,"message-content-group"],["target","_blank",3,"href",4,"ngFor","ngForOf"],["target","_blank",3,"href"],[3,"icon",4,"ngIf"],[3,"background-image",4,"ngIf"],[3,"icon"]],template:function(e,t){1&e&&(i.Yb(0,"nb-chat-message-text",0),i.Ic(1),i.Xb(),i.Gc(2,h,3,1,"ng-container",1),i.Gc(3,p,4,3,"ng-container",1)),2&e&&(i.pc("sender",t.sender)("date",t.date)("message",t.message),i.Fb(1),i.Kc(" ",t.message," "),i.Fb(1),i.pc("ngIf",(null==t.readyFiles?null:t.readyFiles.length)>1),i.Fb(1),i.pc("ngIf",1===(null==t.readyFiles?null:t.readyFiles.length)))},directives:[s.a,a.m,a.l,c.o],encapsulation:2,changeDetection:0}),e})()},cVQz:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("fXoL"),o=n("ofXK"),s=n("waa1");function a(e,t){if(1&e&&(i.Yb(0,"p",3),i.Ic(1),i.Yb(2,"time"),i.Ic(3),i.kc(4,"date"),i.Xb(),i.Xb()),2&e){const e=i.jc();i.Fb(1),i.Kc("",e.sender," "),i.Fb(2),i.Jc(i.mc(4,2,e.date,"shortTime"))}}let c=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Mb({type:e,selectors:[["nb-chat-message-quote"]],inputs:{message:"message",sender:"sender",date:"date",quote:"quote"},decls:5,vars:4,consts:[["class","sender",4,"ngIf"],[1,"quote"],[3,"message"],[1,"sender"]],template:function(e,t){1&e&&(i.Gc(0,a,5,5,"p",0),i.Yb(1,"p",1),i.Ic(2),i.Xb(),i.Yb(3,"nb-chat-message-text",2),i.Ic(4),i.Xb()),2&e&&(i.pc("ngIf",t.sender||t.date),i.Fb(2),i.Kc(" ",t.quote," "),i.Fb(1),i.pc("message",t.message),i.Fb(1),i.Kc(" ",t.message," "))},directives:[o.m,s.a],pipes:[o.e],encapsulation:2,changeDetection:0}),e})()},dT8p:function(e){e.exports=JSON.parse('{"dev":false}')},rk8u:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return z}));var i=n("n2fA"),o=n("FQBZ"),s=n("dT8p"),a=n("2Vo4"),c=n("0EQZ"),r=n("FvrZ"),l=n("8yBR"),d=n("STbY"),h=n("fXoL"),g=n("Witw"),u=n("aceb"),p=n("gvxT"),b=n("kmnG"),f=n("qFsG"),m=n("d3UM"),v=n("ofXK"),C=n("3Pt+"),F=n("bTqV"),x=n("FKr1"),y=n("IyRd"),S=n("znSr"),w=n("NFeN");const I=["emptyItem"],k=["qrPop"],O=["createPop"],N=["folder"],P=["import"];function M(e,t){if(1&e&&(h.Yb(0,"mat-option",23),h.Ic(1),h.Xb()),2&e){const e=t.$implicit;h.pc("value",e.id),h.Fb(1),h.Kc(" ",e.data.name," ")}}function X(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"Create Channel"),h.Xb(),h.Yb(3,"nb-card-body",15),h.Yb(4,"div",16),h.Ic(5," Folder: "),h.Yb(6,"mat-select",17),h.fc("valueChange",(function(t){return h.xc(e),h.jc().newChannelFolder=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newChannelFolderChanged(t.value)})),h.Gc(7,M,2,2,"mat-option",18),h.Xb(),h.Xb(),h.Yb(8,"div",19),h.Yb(9,"input",20),h.fc("ngModelChange",(function(t){return h.xc(e),h.jc().newChannelName=t}))("keydown",(function(t){h.xc(e);const n=h.jc();return n.createNewChannelKeyDown(n.newChannelName,t)})),h.Xb(),h.Xb(),h.Xb(),h.Yb(10,"nb-card-footer"),h.Yb(11,"button",21),h.fc("click",(function(){h.xc(e);const t=h.jc();return t.createNewChannel(t.newChannelName)})),h.Ic(12,"Create"),h.Xb(),h.Yb(13,"button",22),h.fc("click",(function(){return h.xc(e),h.jc().closePopup()})),h.Ic(14,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(6),h.pc("value",e.newChannelFolder),h.Fb(1),h.pc("ngForOf",e.channelFolderListArray),h.Fb(2),h.pc("ngModel",e.newChannelName)}}function Y(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"Scan QR"),h.Xb(),h.Yb(3,"nb-card-body",15),h.Yb(4,"div",24),h.Yb(5,"zxing-scanner",25),h.fc("deviceChange",(function(t){return h.xc(e),h.jc().currentDevice=t}))("scanSuccess",(function(t){return h.xc(e),h.jc().qrSuccessHandler(t)}))("permissionResponse",(function(t){return h.xc(e),h.jc().onHasPermission(t)}))("camerasFound",(function(t){return h.xc(e),h.jc().onCamerasFound(t)}))("torchCompatible",(function(t){return h.xc(e),h.jc().onTorchCompatible(t)})),h.Xb(),h.Xb(),h.Xb(),h.Yb(6,"nb-card-footer"),h.Yb(7,"button",22),h.fc("click",(function(){return h.xc(e),h.jc().closeQR()})),h.Ic(8,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(5),h.pc("torch",e.torchEnabled)("device",e.currentDevice)("formats",e.formatsEnabled)("tryHarder",e.tryHarder)}}function j(e,t){if(1&e&&(h.Yb(0,"mat-option",23),h.Ic(1),h.Xb()),2&e){const e=t.$implicit;h.pc("value",e.id),h.Fb(1),h.Kc(" ",e.data.name," ")}}function q(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"Join Channel"),h.Xb(),h.Yb(3,"nb-card-body",15),h.Yb(4,"div",16),h.Ic(5," Import Folder Structure: "),h.Yb(6,"mat-form-field",26),h.Yb(7,"mat-select",27),h.fc("valueChange",(function(t){return h.xc(e),h.jc().importFolderStructure=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newInviteImportFoldersChanged(t.value)})),h.Yb(8,"mat-option",23),h.Ic(9," On "),h.Xb(),h.Yb(10,"mat-option",23),h.Ic(11," Off "),h.Xb(),h.Xb(),h.Xb(),h.Xb(),h.Yb(12,"div",16),h.Ic(13," Place Into Folder: "),h.Yb(14,"mat-select",17),h.fc("valueChange",(function(t){return h.xc(e),h.jc().newChannelFolder=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newChannelFolderChanged(t.value)})),h.Gc(15,j,2,2,"mat-option",18),h.Xb(),h.Xb(),h.Yb(16,"div",19),h.Yb(17,"input",28),h.fc("ngModelChange",(function(t){return h.xc(e),h.jc().inviteCodeHex=t}))("keydown",(function(t){return h.xc(e),h.jc().importNewChannelKeyDown(t)})),h.Xb(),h.Yb(18,"nb-icon",29),h.fc("click",(function(){return h.xc(e),h.jc().scanQR()})),h.Xb(),h.Xb(),h.Xb(),h.Yb(19,"nb-card-footer"),h.Yb(20,"button",21),h.fc("click",(function(){h.xc(e);const t=h.jc();return t.importNewChannel(t.inviteCode)})),h.Ic(21,"Join"),h.Xb(),h.Yb(22,"button",22),h.fc("click",(function(){return h.xc(e),h.jc().closePopup()})),h.Ic(23,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(7),h.pc("value",e.importFolderStructure),h.Fb(1),h.pc("value",1),h.Fb(2),h.pc("value",0),h.Fb(4),h.pc("value",e.newChannelFolder),h.Fb(1),h.pc("ngForOf",e.channelFolderListArray),h.Fb(2),h.pc("ngModel",e.inviteCodeHex)}}function T(e,t){if(1&e&&(h.Yb(0,"mat-option",23),h.Ic(1),h.Xb()),2&e){const e=t.$implicit;h.pc("value",e.id),h.Fb(1),h.Kc(" ",e.data.name," ")}}function E(e,t){if(1&e){const e=h.Zb();h.Yb(0,"nb-card"),h.Yb(1,"nb-card-header"),h.Ic(2,"New Channel Folder"),h.Xb(),h.Yb(3,"nb-card-body",15),h.Yb(4,"div",16),h.Ic(5," Folder: "),h.Yb(6,"mat-select",17),h.fc("valueChange",(function(t){return h.xc(e),h.jc().newChannelFolder=t}))("selectionChange",(function(t){return h.xc(e),h.jc().newChannelFolderChanged(t.value)})),h.Gc(7,T,2,2,"mat-option",18),h.Xb(),h.Xb(),h.Yb(8,"div",19),h.Yb(9,"input",30),h.fc("ngModelChange",(function(t){return h.xc(e),h.jc().newFolderName=t}))("keydown",(function(t){h.xc(e);const n=h.jc();return n.createNewFolderKeyDown(n.newFolderName,t)})),h.Xb(),h.Xb(),h.Xb(),h.Yb(10,"nb-card-footer"),h.Yb(11,"button",21),h.fc("click",(function(){h.xc(e);const t=h.jc();return t.createNewFolder(t.newFolderName)})),h.Ic(12,"Create"),h.Xb(),h.Yb(13,"button",22),h.fc("click",(function(){return h.xc(e),h.jc().closePopup()})),h.Ic(14,"Cancel"),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=h.jc();h.Fb(6),h.pc("value",e.newChannelFolder),h.Fb(1),h.pc("ngForOf",e.channelFolderListArray),h.Fb(2),h.pc("ngModel",e.newFolderName)}}const B=function(e){return{"drag-start":e}};function D(e,t){if(1&e){const e=h.Zb();h.Yb(0,"mat-tree-node",31),h.fc("dragover",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragOver(n,i)}))("dragend",(function(t){return h.xc(e),h.jc().handleDragEnd(t)}))("drop",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDrop(n,i)}))("click",(function(){h.xc(e);const n=t.$implicit;return h.jc().selectChannel(n.item)})),h.Yb(1,"div"),h.Tb(2,"nb-icon",32),h.Yb(3,"span",33),h.fc("dragstart",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragStart(n,i)})),h.Yb(4,"span",34),h.Ic(5),h.Xb(),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=t.$implicit,n=h.jc();h.pc("ngClass",n.getStyle(e)),h.Fb(1),h.Ib("treeNodeContainerSingle ",e.item,""),h.Kb("active-channel",n.selectedChannel===e.item),h.Fb(3),h.pc("ngClass",h.sc(8,B,n.dragNode===e)),h.Fb(1),h.Kc(" ",e.item," ")}}function L(e,t){if(1&e){const e=h.Zb();h.Yb(0,"mat-tree-node",35),h.fc("dragover",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragOver(n,i)}))("dragend",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragEnd(n,i)}))("drop",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDrop(n,i)})),h.Yb(1,"div",36),h.fc("contextmenu",(function(n){h.xc(e);const i=t.$implicit;return h.jc().onContextMenu(n,i.item)})),h.Yb(2,"button",37),h.Yb(3,"mat-icon",38),h.Ic(4),h.Xb(),h.Xb(),h.Tb(5,"nb-icon",39),h.Yb(6,"span",33),h.fc("dragstart",(function(n){h.xc(e);const i=t.$implicit;return h.jc().handleDragStart(n,i)})),h.Yb(7,"span",34),h.Ic(8),h.Xb(),h.Xb(),h.Xb(),h.Xb()}if(2&e){const e=t.$implicit,n=h.jc();h.pc("ngClass",n.getStyle(e)),h.Fb(2),h.Gb("aria-label","toggle "+e.item),h.Fb(2),h.Kc(" ",n.treeControl.isExpanded(e)?"expand_more":"chevron_right"," "),h.Fb(3),h.pc("ngClass",h.sc(5,B,n.dragNode===e)),h.Fb(1),h.Kc(" ",n.getFolderNameFromId(e.item)," ")}}function _(e,t){if(1&e){const e=h.Zb();h.Yb(0,"button",40),h.fc("click",(function(){h.xc(e);const n=t.item;return h.jc().deleteFolder(n)})),h.Ic(1,"Delete"),h.Xb(),h.Yb(2,"button",40),h.fc("click",(function(){h.xc(e);const n=t.item;return h.jc().onContextMenuAction2(n)})),h.Ic(3,"Rename"),h.Xb(),h.Yb(4,"button",40),h.fc("click",(function(){h.xc(e);const n=t.item;return h.jc().onContextMenuAction2(n)})),h.Ic(5,"Export"),h.Xb()}}class R{}class A{}var K={};let G=(()=>{class e{constructor(){this.dataChange=new a.a([]),this.initialize()}get data(){return this.dataChange.value}initialize(){this.buildFileTree(K,0)}buildFileTree(e,t){return Object.keys(e).reduce((n,i)=>{const o=e[i],s=new R;return s.item=i,null!=o&&("object"==typeof o?s.children=this.buildFileTree(o,t+1):s.item=o),n.concat(s)},[])}insertItem(e,t){e.children||(e.children=[]);const n={item:t};return e.children.push(n),this.dataChange.next(this.data),n}getParentFromNodes(e){for(let t=0;t<this.data.length;++t){const n=this.getParent(this.data[t],e);if(null!=n)return n}return null}getParent(e,t){if(e.children&&e.children.length>0)for(let n=0;n<e.children.length;++n){const i=e.children[n];if(i===t)return e;if(i.children&&i.children.length>0){const e=this.getParent(i,t);if(null!=e)return e}}return null}updateItem(e,t){e.item=t,this.dataChange.next(this.data)}deleteItem(e){this.deleteNode(this.data,e),this.dataChange.next(this.data)}copyPasteItem(e,t){const n=this.insertItem(t,e.item);return e.children&&e.children.forEach(e=>{this.copyPasteItem(e,n)}),n}deleteNode(e,t){const n=e.indexOf(t,0);n>-1?e.splice(n,1):e.forEach(e=>{e.children&&e.children.length>0&&this.deleteNode(e.children,t)})}filter(e){let t;t=e&&e.length>0?{Filter:{emptyFolder:{}},Function:{emptyFolder:{}},Missing:{emptyFolder:{}}}:K;const n=this.buildFileTree(t,0);this.dataChange.next(n)}setQOS(e){this.q=e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=h.Ob({token:e,factory:e.\u0275fac}),e})(),z=(()=>{class t{constructor(e,t,n,i,d,h){this.cd=e,this.database=t,this.ui=n,this.dialog=i,this.nbMenuService=d,this.q=h,this.contextMenuPosition={x:"0px",y:"0px"},this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.newItemName="",this.checklistSelection=new c.c(!0),this.dragNodeExpandOverWaitTimeMs=300,this.getLevel=e=>e.level,this.isExpandable=e=>e.expandable,this.getChildren=e=>e.children,this.hasChild=(e,t)=>t.expandable,this.hasNoContent=(e,t)=>""===t.item,this.transformer=(e,t)=>{const n=this.nestedNodeMap.get(e),i=n&&n.item===e.item?n:new A;return i.item=e.item,i.level=t,i.expandable=e.children&&e.children.length>0,this.flatNodeMap.set(i,e),this.nestedNodeMap.set(e,i),i},this.dragNodeExpandOverAreaReal=0,this.channelNameList=[],this.restoreFlag=0,this.sENwriteBlock=0,this.channelIsSelected="active-channel",this.DEVMODE=s.dev,this.customColumn="name",this.items=[{title:"New Folder"},{title:"New Channel"},{title:"Join Channel"}],this.currentDevice=null,this.formatsEnabled=[o.BarcodeFormat.QR_CODE],this.torchEnabled=!1,this.torchAvailable$=new a.a(!1),this.tryHarder=!1,this.channelFolderListArray=[],this.popupRef=[],this.importFolderStructure=1,this.itemClickSub=this.nbMenuService.onItemClick().subscribe(e=>{"New Channel"==String(e.item.title)?(this.getChannelFolderList(),this.open(this.createPop)):"Join Channel"==String(e.item.title)?(this.getChannelFolderList(),this.open(this.importPop)):"New Folder"==String(e.item.title)&&(this.getChannelFolderList(),this.open(this.folderPop))}),this.database.setQOS(this.q),this.treeFlattener=new l.c(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new r.j(this.getLevel,this.isExpandable),this.dataSource=new l.b(this.treeControl,this.treeFlattener)}onContextMenu(e,t){e.preventDefault(),this.contextMenuPosition.x=e.clientX+"px",this.contextMenuPosition.y=e.clientY-40+"px",this.contextMenu.menuData={item:t},this.contextMenu.openMenu()}onContextMenuAction1(e){}onContextMenuAction2(e){}descendantsAllSelected(e){return this.treeControl.getDescendants(e).every(e=>this.checklistSelection.isSelected(e))}descendantsPartiallySelected(e){return this.treeControl.getDescendants(e).some(e=>this.checklistSelection.isSelected(e))&&!this.descendantsAllSelected(e)}todoItemSelectionToggle(e){this.checklistSelection.toggle(e);const t=this.treeControl.getDescendants(e);this.checklistSelection.isSelected(e)?this.checklistSelection.select(...t):this.checklistSelection.deselect(...t)}saveNode(e,t){const n=this.flatNodeMap.get(e);this.database.updateItem(n,t)}handleDragStart(e,t){this.dragNode=t,this.treeControl.collapse(t)}handleDragOver(e,t){if(e.preventDefault(),-1===t.item.indexOf("-----")){this.dragNodeExpandOverNode&&t===this.dragNodeExpandOverNode?Date.now()-this.dragNodeExpandOverTime>this.dragNodeExpandOverWaitTimeMs&&(this.treeControl.isExpanded(t)||this.treeControl.expand(t)):(this.dragNodeExpandOverNode=t,this.dragNodeExpandOverTime=(new Date).getTime());const n=e.offsetY/e.target.clientHeight;0<=n&&n<=.25?(this.dragNodeExpandOverArea=0,this.dragNodeExpandOverAreaReal=1):1>=n&&n>=.75?(this.dragNodeExpandOverArea=0,this.dragNodeExpandOverAreaReal=-1):(this.dragNodeExpandOverAreaReal=0,this.dragNodeExpandOverArea=0)}}handleDrop(e,t){if(t!==this.dragNode&&t.item.indexOf("-----")<0){let e;1===this.dragNodeExpandOverAreaReal||-1===this.dragNodeExpandOverAreaReal||(e=this.flatNodeMap.get(this.dragNode),this.database.deleteItem(e),e=this.database.copyPasteItem(e,this.flatNodeMap.get(t)),this.saveExpandedNodes(),this.buildChannelFolderListFromTreeNodeData())}this.handleDragEnd(e)}handleDragEnd(e){this.dragNode=null,this.dragNodeExpandOverNode=null,this.dragNodeExpandOverTime=0,this.dragNodeExpandOverArea=NaN,e.preventDefault()}getStyle(e){if("emptyFolder"==e.item)return"display-none";if(this.dragNode===e)return"drag-start";if(this.dragNodeExpandOverNode===e)switch(this.dragNodeExpandOverArea){case 1:return"drop-above";case-1:return"drop-below";default:return"drop-center"}}closeQR(){setTimeout(()=>{this.closePopup()},500)}scanQR(){this.open(this.qrPop)}deleteItem(e){this.database.deleteItem(this.flatNodeMap.get(e))}filterChanged(e){this.database.filter(e),e?this.treeControl.expandAll():this.treeControl.collapseAll()}getFolderNameFromId(e){return"emptyFolder"==e?e:this.q.os.bee.config.getFolderNameFromId(e)}isFolder(e){return!(e.indexOf("-----")>-1)}ngOnDestroy(){console.log("ChannelList: ngOnDestroy..."),this.itemClickSub.unsubscribe(),this.dataChangeSub.unsubscribe(),this.channelFolderListSub.unsubscribe(),this.selectedChannelSub.unsubscribe()}createNewChannelKeyDown(e,t){13===t.keyCode&&this.createNewChannel(e)}importNewChannelKeyDown(e){13===e.keyCode&&this.importNewChannel()}createNewFolderKeyDown(e,t){13===t.keyCode&&this.createNewFolder(e)}ngOnInit(){return Object(i.a)(this,void 0,void 0,(function*(){for(;!this.q.os.isSignedIn();)console.log("ChannelList: Waiting for OS Sign In..."),yield this.ui.delay(1e3);this.channelNameList=this.q.os.ocean.dolphin.getChannelNameList(),this.channelFolderList=this.q.os.bee.config.getChannelFolderList(),this.dataChangeSub=this.database.dataChange.subscribe(e=>{this.dataSource.data=[],this.dataSource.data=e}),this.channelFolderListSub=this.q.os.bee.config.channelFolderListSub.subscribe(e=>{this.loadChannels(e)}),this.selectedChannelSub=this.q.os.channel.onSelect().subscribe(e=>{this.selectedChannel=e}),this.loadChannels(this.channelFolderList),this.selectedChannel=this.q.os.channel.getSelected(),this.cd.detectChanges()}))}loadChannels(e){K=this.q.os.bee.config.getChannelFolderIDList(),this.database.filter(""),e.length>0&&this.q.os.bee.config.getExpandedChannelFolderItems().length>0&&(console.log("got a saved state!"),this.expandedNodes=this.q.os.bee.config.getExpandedChannelFolderItems(),this.restoreExpandedNodes())}saveExpandedNodes(){this.sENwriteBlock=1,this.expandedNodes=[];for(let e=0;e<this.treeControl.dataNodes.length;e++){let t=this.treeControl.dataNodes[e];t.expandable&&this.treeControl.isExpanded(t)&&this.expandedNodes.push(t)}return console.log("ChannelList: Persisting expanded folders..."),this.q.os.bee.config.setExpandedChannelFolderItems(this.expandedNodes),this.sENwriteBlock=0,!0}buildChannelFolderListFromTreeNodeData(){console.log("!!!!!"),console.log(this.database.data);let e=this.database.data;e=e.filter(e=>"emptyFolder"!=e.item);let t=[];for(let n=0;n<e.length;n++){console.log(e[n]);let i="dir";e[n].item.indexOf("-----")>-1&&(i="channel"),console.log(i);let o=[];void 0!==e[n].children&&e[n].children.length>0&&(o=this.getFolderListTreeChildrenRec(e[n].children)),t.push({id:e[n].item,data:{name:this.q.os.bee.config.getFolderNameFromId(e[n].item),kind:i,items:0},children:o})}return this.q.os.bee.config.setChannelFolderList(t),!0}selectChannel(e){console.log("ChannelList: Trying to select: >>"+e.trim()),this.q.os.utilities.inArray(this.q.os.ocean.dolphin.getChannelNameList(),e.trim())&&(console.log("ChannelList: Selecting: ",e.trim()),this.q.os.channel.select(e.trim()),this.q.os.ui.getSideBarFixed().left&&this.q.os.ui.hideSideBar("left"),this.cd.detectChanges(),setTimeout(()=>{this.scrollBottom()},2500),setTimeout(()=>{this.scrollBottom()},5500),setTimeout(()=>{this.scrollBottom()},4e3))}getSelected(){return JSON.stringify(this.selectedChannel)}scrollBottom(){try{this.scrollable={},this.scrollable.nativeElement=window["quest-network-ui-globals"]["messages-chat-scrollable"],null!=this.scrollable.nativeElement&&this.scrollable.nativeElement.scrollTop>this.scrollable.nativeElement.scrollHeight-$(this.scrollable.nativeElement).height()-210&&(this.scrollable.nativeElement.scrollTop=this.scrollable.nativeElement.scrollHeight)}catch(e){console.log(e)}}getFolderListTreeChildrenRec(e){let t=[];for(let n=0;n<e.length;n++){console.log(e[n]);let i="dir";e[n].item.indexOf("-----")>-1&&(i="channel");let o=[];void 0!==e[n].children&&e[n].children.length>0&&(o=this.getFolderListTreeChildrenRec(e[n].children)),t.push({id:e[n].item,data:{name:this.q.os.bee.config.getFolderNameFromId(e[n].item),kind:i,items:0},children:o})}return t}restoreExpandedNodes(){this.sENwriteBlock=1;for(let e=0;e<this.expandedNodes.length;e++){let t=this.expandedNodes[e];console.log(t),console.log(this.treeControl.dataNodes),this.treeControl.expand(this.treeControl.dataNodes.find(e=>e.item===t.item))}this.sENwriteBlock=0}onCamerasFound(e){this.availableDevices=e,this.hasDevices=Boolean(e&&e.length)}onDeviceSelectChange(e){const t=this.availableDevices.find(t=>t.deviceId===e);this.currentDevice=t||null}onHasPermission(e){this.hasPermission=e}onTorchCompatible(e){this.torchAvailable$.next(e||!1)}toggleTorch(){this.torchEnabled=!this.torchEnabled}toggleTryHarder(){this.tryHarder=!this.tryHarder}qrSuccessHandler(e){console.log(e),this.inviteCodeHex=e,this.closePopup()}getChannelFolderList(){return this.channelFolderList=this.q.os.bee.config.getChannelFolderList(),this.channelFolderListArray=[],this.parseStructure(this.channelFolderList),this.channelFolderListArray.length>0&&(this.newChannelFolder=this.channelFolderListArray[0]),this.channelFolderList}parseStructure(e){for(let t=0;t<e.length;t++)-1===e[t].data.name.indexOf("-----")&&"emptyFolder"!=e[t].data.name&&(this.channelFolderListArray.push(e[t]),void 0!==e[t].children&&this.parseStructure(e[t].children));return e}newChannelFolderChanged(){}createNewChannel(e){return Object(i.a)(this,void 0,void 0,(function*(){this.saveExpandedNodes(),console.log(e);let t=e;this.ui.showSnack("Creating Channel...","Please Wait");let n=this.newChannelFolder;"object"==typeof n&&(n=""),yield this.q.os.channel.create(t,n),this.createCompleteAndClose()}))}open(e){this.popupRef.push(this.dialog.open(e,{context:"this is some additional data passed to dialog"}))}closePopup(){console.log("close toggled"),this.popupRef[this.popupRef.length-1].close(),this.popupRef.pop()}createCompleteAndClose(){this.ui.delay(1e3),this.q.os.bee.config.commit(),this.ui.showSnack("Success!","Yesss",{duration:1e3}),this.closePopup()}createNewFolder(e){this.saveExpandedNodes(),this.ui.showSnack("Creating Folder...","Please Wait");let t=this.newChannelFolder;"object"==typeof t&&(t=""),this.q.os.bee.config.createChannelFolder(e,t),this.createCompleteAndClose()}deleteFolder(e){console.log("Deleting Folder..."),console.log(e);let t=this.q.os.bee.config.checkIfFolderIdChannels(e);console.log(t),t?this.ui.showSnack("Folder has channels!","Sorry but no.",{duration:5e3}):(this.ui.showSnack("Deleting Folder...","Please Wait"),this.saveExpandedNodes(),this.q.os.bee.config.deleteFolder(e),this.createCompleteAndClose())}importChannelFolderChanged(){}importNewChannel(){return Object(i.a)(this,void 0,void 0,(function*(){this.saveExpandedNodes(),this.ui.showSnack("Importing Channel...","Please Wait");let t,n,i=e.from(this.inviteCodeHex,"hex").toString("utf8"),o=i.split("/////");o.length>0?(t=o[o.length-1].split(":")[0],n=o[o.length-1].split(":")[1],o.pop()):(t=i.split(":")[0],n=i.split(":")[1]);let s=this.newChannelFolder;"object"!=typeof s&&void 0!==s&&null!=typeof s||(s=""),this.q.os.utilities.inArray(this.q.os.ocean.dolphin.getChannelNameList(),t)?this.ui.showSnack("Channel Exists!","Oops",{duration:1e3}):(yield this.q.os.channel.import(t,o,s,n,this.importFolderStructure),this.createCompleteAndClose())}))}newInviteImportFoldersChanged(){}}return t.\u0275fac=function(e){return new(e||t)(h.Sb(h.h),h.Sb(G),h.Sb(g.a),h.Sb(u.l),h.Sb(u.y),h.Sb(p.a))},t.\u0275cmp=h.Mb({type:t,selectors:[["messages-channel-list"]],viewQuery:function(e,t){var n;1&e&&(h.Mc(d.d,!0),h.Mc(I,!0),h.Mc(k,!0),h.Mc(O,!0),h.Mc(N,!0),h.Mc(P,!0)),2&e&&(h.uc(n=h.gc())&&(t.contextMenu=n.first),h.uc(n=h.gc())&&(t.emptyItem=n.first),h.uc(n=h.gc())&&(t.qrPop=n.first),h.uc(n=h.gc())&&(t.createPop=n.first),h.uc(n=h.gc())&&(t.folderPop=n.first),h.uc(n=h.gc())&&(t.importPop=n.first))},features:[h.Eb([G])],decls:21,vars:9,consts:[["createPop",""],["qrPop",""],["import",""],["folder",""],[2,"width","169px","margin-top","20px","color","#598adb"],["matInput","","placeholder","Search",3,"input"],["outline","","size","small",1,"addChannelButton",3,"nbContextMenu"],["icon","plus-outline",2,"font-size","18px","width","auto"],[3,"dataSource","treeControl"],["matTreeNodeToggle","","matTreeNodePadding","",3,"ngClass","dragover","dragend","drop","click",4,"matTreeNodeDef"],["matTreeNodePadding","",3,"ngClass","dragover","dragend","drop",4,"matTreeNodeDef","matTreeNodeDefWhen"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],["contextMenu","matMenu"],["matMenuContent",""],["emptyItem",""],[2,"color","goldenrod"],[2,"padding","20px"],[2,"width","80%","margin-left","10px",3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[2,"padding","20px","padding-bottom","34px","padding-top","0px","color","white !important"],["matInput","","placeholder","Channel Name","value","","name","newChannelName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange","keydown"],["mat-stroked-button","","color","primary",2,"margin-right","20px","border","1px solid #ffffff24",3,"click"],["mat-stroked-button","","color","primary",2,"border","1px solid #ffffff24",3,"click"],[3,"value"],[1,"qrScanWrapper"],[3,"torch","device","formats","tryHarder","deviceChange","scanSuccess","permissionResponse","camerasFound","torchCompatible"],[2,"width","19%"],[3,"value","valueChange","selectionChange"],["matInput","","placeholder","Invite Code","value","","name","inviteCodeHex",2,"color","black","background-color","goldenrod","padding","7px","margin-right","5%","width","80%",3,"ngModel","ngModelChange","keydown"],["icon","camera-outline",1,"deleteCode","scanQRCode",3,"click"],["matInput","","placeholder","Folder Name","value","","name","newFolderName",2,"color","black","background-color","goldenrod","padding","7px",3,"ngModel","ngModelChange","keydown"],["matTreeNodeToggle","","matTreeNodePadding","",3,"ngClass","dragover","dragend","drop","click"],["icon","activity"],["draggable","true",1,"checklist-leaf-node",3,"dragstart"],[1,"nodeContent",3,"ngClass"],["matTreeNodePadding","",3,"ngClass","dragover","dragend","drop"],[1,"treeNodeContainerFolder",3,"contextmenu"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],["icon","folder-outline"],["mat-menu-item","",3,"click"]],template:function(e,t){if(1&e&&(h.Gc(0,X,15,3,"ng-template",null,0,h.Hc),h.Gc(2,Y,9,4,"ng-template",null,1,h.Hc),h.Gc(4,q,24,6,"ng-template",null,2,h.Hc),h.Gc(6,E,15,3,"ng-template",null,3,h.Hc),h.Yb(8,"mat-form-field",4),h.Yb(9,"input",5),h.fc("input",(function(e){return t.filterChanged(e.target.value)})),h.Xb(),h.Xb(),h.Yb(10,"button",6),h.Tb(11,"nb-icon",7),h.Xb(),h.Yb(12,"mat-tree",8),h.Gc(13,D,6,10,"mat-tree-node",9),h.Gc(14,L,9,7,"mat-tree-node",10),h.Xb(),h.Tb(15,"div",11),h.Yb(16,"mat-menu",null,12),h.Gc(18,_,6,0,"ng-template",13),h.Xb(),h.Tb(19,"span",null,14)),2&e){const e=h.vc(17);h.Fb(10),h.pc("nbContextMenu",t.items),h.Fb(2),h.pc("dataSource",t.dataSource)("treeControl",t.treeControl),h.Fb(2),h.pc("matTreeNodeDefWhen",t.hasChild),h.Fb(1),h.Dc("left",t.contextMenuPosition.x)("top",t.contextMenuPosition.y),h.pc("matMenuTriggerFor",e)}},directives:[b.b,f.a,u.i,u.o,l.a,l.f,d.d,d.e,d.a,u.d,u.f,u.c,m.a,v.l,C.b,C.j,C.m,u.e,F.a,x.g,y.a,l.e,l.h,l.g,v.k,S.a,w.a,d.b],styles:["button[nbTreeGridRowToggle][_ngcontent-%COMP%]{background:transparent;border:none;padding:0}.search-label[_ngcontent-%COMP%]{display:block}.search-input[_ngcontent-%COMP%]{background:transparent;color:#fff;padding:5px;font-size:12px;width:100%;margin-top:1rem;margin-bottom:1rem;width:78%;margin-left:1%}.addChannelButton[_ngcontent-%COMP%]{color:rgba(134,116,183,.7490196078431373);margin-left:5%;position:relative;top:1px;background-color:#45267d;border:1px solid;border-radius:5px;padding:4px;opacity:.7}.nb-column-name[_ngcontent-%COMP%]{width:80%}.nb-column-items[_ngcontent-%COMP%]{width:20%}.scanQRCode[_ngcontent-%COMP%]{font-size:37px;color:#315cdf;cursor:pointer}.scanQRCode[_ngcontent-%COMP%]:hover{color:#4a81e6}[_nghost-%COMP%]   nb-layout-header[_ngcontent-%COMP%]     nav{justify-content:flex-end}.mat-tree[_ngcontent-%COMP%], .mat-tree-node[_ngcontent-%COMP%]{background:transparent}.mat-tree-node[_ngcontent-%COMP%]{overflow:visible;cursor:move}.drop-above[_ngcontent-%COMP%]{border-top:10px solid #2196f3;margin-top:-10px}.drop-below[_ngcontent-%COMP%]{border-bottom:10px solid #2196f3;margin-bottom:-10px}.drop-center[_ngcontent-%COMP%]{background-color:#a9a9a9}.drag-start[_ngcontent-%COMP%]{background-color:#1565c0;color:#f0fff0}.treeNodeContainerFolder[_ngcontent-%COMP%]{background-color:rgba(131,119,230,.058823529411764705);padding:0 16px 0 0}.treeNodeContainerFolder[_ngcontent-%COMP%], .treeNodeContainerSingle[_ngcontent-%COMP%]{border-radius:5px;margin:0;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.treeNodeContainerSingle[_ngcontent-%COMP%]{background-color:rgba(69,39,128,.3686274509803922);padding:6px 10px 6px 15px}.mat-tree[_ngcontent-%COMP%]{z-index:999;width:227px;left:14px;top:190px;padding-right:10px;bottom:40px;position:fixed;overflow:scroll}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3)}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:rgba(78,132,229,.5607843137254902);outline:0}.mat-tree[_ngcontent-%COMP%]::-webkit-scrollbar-track{box-shadow:none!important}.emptyFolder[_ngcontent-%COMP%]{display:none}.mat-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .mat-icon-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{line-height:20px}.qrScanWrapper[_ngcontent-%COMP%]{min-width:20px;max-height:80vh;max-width:37vw}"]}),t})()}).call(this,n("tjlA").Buffer)},tayM:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));class i{}},waa1:function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var i=n("fXoL"),o=n("tyNb"),s=n("gvxT"),a=n("ofXK"),c=n("aceb"),r=n("zwFz"),l=n("fP41");function d(e,t){1&e&&i.Tb(0,"nb-icon",7)}function h(e,t){1&e&&i.Tb(0,"nb-icon",8)}function g(e,t){if(1&e){const e=i.Zb();i.Yb(0,"p",4),i.fc("click",(function(){i.xc(e);const t=i.jc();return t.goToProfile(t.sender.social)})),i.Ic(1),i.Gc(2,d,1,0,"nb-icon",5),i.Gc(3,h,1,0,"nb-icon",6),i.Xb()}if(2&e){const e=i.jc();i.Fb(1),i.Kc(" ",e.sender.name," "),i.Fb(1),i.pc("ngIf",e.sender.isRequestedFavorite),i.Fb(1),i.pc("ngIf",e.sender.isFavorite)}}function u(e,t){if(1&e&&(i.Yb(0,"p",9),i.Ic(1),i.Xb()),2&e){const e=i.jc();i.Fb(1),i.Kc(" ",e.sender.name," ")}}const p=function(){return{newWindow:!0}};function b(e,t){if(1&e&&(i.Tb(0,"div",17),i.kc(1,"linky")),2&e){const e=i.jc().$implicit;i.pc("innerHTML",i.mc(1,1,e.text,i.rc(4,p)),i.yc)}}function f(e,t){if(1&e&&i.Tb(0,"ngx-emoji",18),2&e){const e=i.jc().$implicit;i.pc("emoji",e.emojiColon)}}function m(e,t){if(1&e&&(i.Yb(0,"div",14),i.Gc(1,b,2,5,"div",15),i.Gc(2,f,1,1,"ngx-emoji",16),i.Xb()),2&e){const e=t.$implicit;i.Fb(1),i.pc("ngIf",!e.isEmoji),i.Fb(1),i.pc("ngIf",e.isEmoji)}}function v(e,t){if(1&e&&(i.Yb(0,"div",12),i.Gc(1,m,3,2,"div",13),i.Xb()),2&e){const e=t.$implicit;i.Fb(1),i.pc("ngForOf",e)}}function C(e,t){if(1&e&&(i.Yb(0,"div",10),i.Gc(1,v,2,1,"div",11),i.Xb()),2&e){const e=i.jc();i.Fb(1),i.pc("ngForOf",e.messageRows)}}function F(e,t){if(1&e&&(i.Yb(0,"div"),i.Tb(1,"ngx-emoji",19),i.Xb()),2&e){const e=i.jc();i.Fb(1),i.qc("emoji",e.messageRows[0][0].emojiColon)}}let x=(()=>{class e{constructor(e,t,n){this.ngZone=e,this.router=t,this.q=n,this.scrollable={}}scrollBottom(){try{this.scrollable.nativeElement=window["quest-network-ui-globals"]["messages-chat-scrollable"],null!=this.scrollable.nativeElement&&this.scrollable.nativeElement.scrollTop>this.scrollable.nativeElement.scrollHeight-$(this.scrollable.nativeElement).height()-210&&(this.scrollable.nativeElement.scrollTop=this.scrollable.nativeElement.scrollHeight)}catch(e){console.log(e)}}ngOnInit(){this.messageRows=this.getArray(this.message),this.scrollBottom()}ngOnChanges(){this.messageRows=this.getArray(this.message),this.scrollBottom()}goToProfile(e){this.ngZone.run(()=>this.router.navigate(["/social/profile/"+e]))}getArray(e){let t=[],n=[],i=[],o=String(e).trim();try{let e=["\n:","\n :","\n  :"];for(let t of e)o=o.replace(new RegExp(t,"g")," :")}catch(s){}try{let e=[":D",":\\)","=\\)",":-\\)","=D"];for(let n of e)o=o.replace(new RegExp(n,"g"),":grinning:");let t=/:(?![\n])[()#$@-\w]+:/g.exec(o);for(let n of t)n.substr(1,n.length-2).indexOf(":")<0&&(o=o.replace(n," "+n+" "))}catch(s){console.log(s)}n=o.trim().split("\n"),i=[];for(let a of n)i.push(a.trim().split(" "));for(let a=0;a<i.length;a++)for(let e=0;e<i[a].length;e++){let n=String(i[a][e]).trim();if(0==n.indexOf(":")&&n.substr(1).indexOf(":")==n.length-2){let o={isEmoji:!0,emojiColon:n.substr(1,n.length-2)};if(1==t.length)return o;i[a][e]=o}else i[a][e]={isEmoji:!1,text:n}}return i}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(i.C),i.Sb(o.c),i.Sb(s.a))},e.\u0275cmp=i.Mb({type:e,selectors:[["nb-chat-message-text"]],inputs:{sender:"sender",message:"message",date:"date"},features:[i.Db],decls:4,vars:4,consts:[["class","sender","class","socialLink messageDisplayName",3,"click",4,"ngIf"],["class","sender","class","messageDisplayName",4,"ngIf"],["class","text",4,"ngIf"],[4,"ngIf"],[1,"socialLink","messageDisplayName",3,"click"],["icon","star-outline","class","senderIcon messageSenderStarIcon",4,"ngIf"],["icon","heart-outline","class","senderIcon",4,"ngIf"],["icon","star-outline",1,"senderIcon","messageSenderStarIcon"],["icon","heart-outline",1,"senderIcon"],[1,"messageDisplayName"],[1,"text"],["style","display:block;clear:both;",4,"ngFor","ngForOf"],[2,"display","block","clear","both"],["class","chunkContainer",4,"ngFor","ngForOf"],[1,"chunkContainer"],["class","textChunk",3,"innerHTML",4,"ngIf"],["class","emojiChunk","set","apple","size","22","style","display:inline-block;max-height: 22px;overflow: hidden;",3,"emoji",4,"ngIf"],[1,"textChunk",3,"innerHTML"],["set","apple","size","22",1,"emojiChunk",2,"display","inline-block","max-height","22px","overflow","hidden",3,"emoji"],["set","apple","size","64",1,"",3,"emoji"]],template:function(e,t){1&e&&(i.Gc(0,g,4,3,"p",0),i.Gc(1,u,2,1,"p",1),i.Gc(2,C,2,1,"div",2),i.Gc(3,F,2,1,"div",3)),2&e&&(i.pc("ngIf","unknown"!==t.sender.social),i.Fb(1),i.pc("ngIf","unknown"==t.sender.social),i.Fb(1),i.pc("ngIf",t.messageRows.length>0&&(t.messageRows.length>1||!t.messageRows[0][0].isEmoji)),i.Fb(1),i.pc("ngIf",1==t.messageRows.length&&1==t.messageRows[0].length&&t.messageRows[0][0].isEmoji))},directives:[a.m,c.o,a.l,r.a],pipes:[l.b],styles:[".senderIcon[_ngcontent-%COMP%]{top:-2px;position:relative;color:#d2d24b}.socialLink[_ngcontent-%COMP%]{cursor:pointer}.messageDisplayName[_ngcontent-%COMP%]{color:#d6d8dc!important;padding-bottom:5px!important}.messageSenderStarIcon[_ngcontent-%COMP%]{color:#256dff!important}.emojiChunk[_ngcontent-%COMP%]{max-height:22px;overflow:hidden;margin:0;position:relative;top:5px;padding:0 2px}.chunkContainer[_ngcontent-%COMP%], .emojiChunk[_ngcontent-%COMP%], .messagesInnerWrapper[_ngcontent-%COMP%], .textChunk[_ngcontent-%COMP%]{display:inline-block}.textChunk[_ngcontent-%COMP%]{white-space:nowrap;padding-left:2px;padding-right:2px;max-height:22px}"],changeDetection:0}),e})()},xUDc:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n("R0Ic"),o=n("fXoL"),s=n("jhN1"),a=n("ofXK"),c=n("bzWg"),r=n("cVQz"),l=n("K9Od"),d=n("waa1");function h(e,t){if(1&e&&(o.Wb(0),o.Ic(1),o.Vb()),2&e){const e=o.jc(2);o.Fb(1),o.Kc(" ",e.getInitials()," ")}}function g(e,t){if(1&e&&(o.Yb(0,"div",7),o.Gc(1,h,2,1,"ng-container",8),o.Xb()),2&e){const e=o.jc();o.Dc("background-image",e.avatarStyle),o.Fb(1),o.pc("ngIf",!e.avatarStyle)}}function u(e,t){if(1&e&&o.Tb(0,"nb-chat-message-file",9),2&e){const e=o.jc();o.pc("sender",e.sender)("date",e.date)("message",e.message)("files",e.files)}}function p(e,t){if(1&e&&o.Tb(0,"nb-chat-message-quote",10),2&e){const e=o.jc();o.pc("sender",e.sender)("date",e.date)("message",e.message)("quote",e.quote)}}function b(e,t){if(1&e&&o.Tb(0,"nb-chat-message-map",11),2&e){const e=o.jc();o.pc("sender",e.sender)("date",e.date)("message",e.message)("latitude",e.latitude)("longitude",e.longitude)}}function f(e,t){if(1&e&&o.Tb(0,"nb-chat-message-text",12),2&e){const e=o.jc();o.pc("sender",e.sender)("date",e.date)("message",e.message)}}let m=(()=>{class e{constructor(e){this.domSanitizer=e,this._reply=!1}get flyInOut(){return!0}get notReply(){return!this.reply}get reply(){return this._reply}set reply(e){var t;this._reply="string"==typeof(t=e)?"true"===(t=t.toLowerCase().trim())||""===t:!!t}set avatar(e){this.avatarStyle=e?this.domSanitizer.bypassSecurityTrustStyle(`url(${e})`):null}getInitials(){return this.sender?this.sender.split(" ").map(e=>e.charAt(0)).splice(0,2).join("").toUpperCase():""}}return e.\u0275fac=function(t){return new(t||e)(o.Sb(s.b))},e.\u0275cmp=o.Mb({type:e,selectors:[["nb-chat-message"]],hostVars:5,hostBindings:function(e,t){2&e&&(o.Fc("@flyInOut",t.flyInOut),o.Kb("not-reply",t.notReply)("reply",t.reply))},inputs:{reply:"reply",message:"message",sender:"sender",date:"date",files:"files",quote:"quote",latitude:"latitude",longitude:"longitude",avatar:"avatar",type:"type"},decls:7,vars:5,consts:[["class","avatar",3,"background-image",4,"ngIf"],[1,"message"],[3,"ngSwitch"],[3,"sender","date","message","files",4,"ngSwitchCase"],[3,"sender","date","message","quote",4,"ngSwitchCase"],[3,"sender","date","message","latitude","longitude",4,"ngSwitchCase"],[3,"sender","date","message",4,"ngSwitchDefault"],[1,"avatar"],[4,"ngIf"],[3,"sender","date","message","files"],[3,"sender","date","message","quote"],[3,"sender","date","message","latitude","longitude"],[3,"sender","date","message"]],template:function(e,t){1&e&&(o.Gc(0,g,2,3,"div",0),o.Yb(1,"div",1),o.Wb(2,2),o.Gc(3,u,1,4,"nb-chat-message-file",3),o.Gc(4,p,1,4,"nb-chat-message-quote",4),o.Gc(5,b,1,5,"nb-chat-message-map",5),o.Gc(6,f,1,3,"nb-chat-message-text",6),o.Vb(),o.Xb()),2&e&&(o.pc("ngIf",!t.reply),o.Fb(2),o.pc("ngSwitch",t.type),o.Fb(1),o.pc("ngSwitchCase","file"),o.Fb(1),o.pc("ngSwitchCase","quote"),o.Fb(1),o.pc("ngSwitchCase","map"))},directives:[a.m,a.o,a.p,a.q,c.a,r.a,l.a,d.a],encapsulation:2,data:{animation:[Object(i.m)("flyInOut",[Object(i.j)("in",Object(i.k)({transform:"translateX(0)"})),Object(i.l)("void => *",[Object(i.k)({transform:"translateX(-100%)"}),Object(i.e)(80)]),Object(i.l)("* => void",[Object(i.e)(80,Object(i.k)({transform:"translateX(100%)"}))])])]},changeDetection:0}),e})()}}]);